{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.js","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\leaflet\\\\dist\\\\leaflet-src.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\leaflet-knn\\\\index.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\firebase\\\\dist\\\\index.cjs.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\leaflet-offline\\\\src\\\\leaflet-offline.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\localforage\\\\dist\\\\localforage.js\""],"names":["require","myMap","setupBaseLayer","greyscaleLayer","L","tileLayer","offline","App","State","settings","mbUrl","tilesDb","id","attribution","mbAttr","maxZoom","maxNativeZoom","streetsLayer","on","alert","satLayer","minZoom","myLayerGroup","layerGroup","map","center","defaultCenter","zoom","defaultZoom","zoomDelta","layers","baseMaps","Greyscale","Streets","Satellite","overlayMaps","myLayers","LayersControl","control","addTo","symbology","taskCompleteStyle","fillColor","color","weight","pointTaskNotCompleteStyle","lineTaskNotCompleteStyle","polyTaskNotCompleteStyle","uploadjsonURL","editform","assetConditionOptions","relatedData","latestLocation","relDataSyncStatus","surveyed","completedResetDate","Date","uncompletedColor","uncompletedfillColor","uncompletedLineWeight","completedLineWeight","uncompletedRadius","completedColor","completedFillColor","completedRadius","visableFeatures","formFields","condition","null","c1","c2","c3","c4","c5","c6","rm","nv","pv","AddPointButtonsPoints","label","AddPointButtonsLines","populateInputOptions","el","items","Object","keys","forEach","option","document","createElement","value","key","text","add","updateRelDataSyncMsg","syncStatus","msg","innerHTML","style","whenGeoFeatureClicked","fId","selectedFeature","properties","OBJECTID","geometry","type","renderSideBar","sidebar","setContent","getElementById","p","generateFeatureEditFormElements","photo","getPhoto","updateSidebarRelatedFromState","show","findNearestFeatures","nearest","geoLayer","latLng","layer","fire","window","props","sectionEl","createFormItem","parentTag","prop","createWrapperDiv","x","appendChild","createValueLabel","parent","checked","createLabel","createRow","wrapperDiv","createFormItems","propType","resetMap","localStorage","removeItem","fetch","photoURL","then","res","blob","objectURL","URL","createObjectURL","myImage","Image","src","css","initSettingsControl","Control","myControl","extend","onAdd","myControl_div","DomUtil","create","title","onclick","initLoginForm","populateMapMeta","addEventListener","loadMyLayer","opts","position","Map","container","content","item","mapMeta","String","busyWorkingIndicator","cogIcon","getElementsByClassName","busyWorking","classList","remove","retrieveMapFromFireBase","index","nodePath","hide","fbDatabase","ref","once","mapData","snapshot","val","clearLocalStorageMaps","setupGeoLayer","display","catch","console","log","err","saveMapToLocalStorage","myKey","setItem","JSON","stringify","getLocalStorageMapDataKey","clearLocalStorageLatestRelDataBackup","populateRelated","related","relDataObject","relDataSyncObject","getLastRelDataItem","sortedKeys","RelDataSet","sort","lastDataItem","length","relKey","itemOb","lastItem","getRelDataFromLocalStorage","mapHash","regex","relDataKeys","filter","match","parse","getItem","itemFeatureKey","split","relDataFeaturePath","localStorageTime","timestamp","stateTime","getTime","updateFeatureRelatedState","RelatedData","pushRelatedDataRecord","featureKey","setCompletedStyle","featureOb","layerOb","objectID","ObjectType","isCompleted","undefined","relDataDate","refDate","relDate","setStyle","radius","reldiv","relSet","meta","clearLayers","featureLabelField","Meta","LabelProperty","relData","Related","geoJson","Geo","onEachFeature","feature","featureLabel","featureContentPopup","addNoteButtonContent","createPopupContentButtonSet","bindPopup","selectedLayer","unsetSelectedStyle","beforeSelectedColor","options","beforeSelectedFillColor","beforeSelectedLineWeight","fillOpacity","uncompletedFillColor","pointToLayer","latlng","circleMarker","stroke","opacity","interactive","addLayer","fitBounds","getBounds","movePolygonsToBack","eachLayer","bringToBack","RegExp","test","loadMapDataFromLocalStorage","storageKey","mapKey","addPointForm","sidebarContent","buttonSetType","popupContent","createButtons","buttonSet","button","featureLabels","bounds","unbindTooltip","getZoom","redrawToolTips","relID","hasRelData","getLatLng","contains","push","intersects","bindTooltip","Asset","permanent","saveRelDataRecordToLocalStorage","relDataPath","relatedRecord","f_id","snap","localStorageKey","submit","user","firebase","auth","currentUser","displayName","comments","backupUpRelStateToLocalStorage","restoreRelStateFromLocalStorage","addPhoto","files","name","uploadMapToFirebase","set","toGeoJSON","error","User","layerName","loadProject","retriveMapIndexFromFirebase","insertAdjacentHTML","displayMapIndeces","message","mapIndexList","values","btn","setAttribute","mapID","description","className","e","target","mapIndex","maplist","initLogoWatermark","watermark","setupOfflineBaseLayerControls","myBaseLayerControls","object","class","saveButtonHtml","removeButtonHtml","confirmSavingCallback","nTilesToSave","continueSaveTiles","confirm","confirmRemovalCallback","continueRemoveTiles","OfflineBaselayersControl","OfflineBaselayersControl_div","offlineLayerCtrls","querySelectorAll","fireBaseconfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","offlineLayerControls","initApp","initializeApp","database","scale","setupSideBar","initLocationControl","doubleClickZoom","disable","navigator","serviceWorker","register","registrationError","closeButton","autoPan","addControl","lc","locate","keepCurrentZoomLevel","strings","cacheLocation","locateOptions","enableHighAccuracy","timeout","maximumAge","icon","updateLatestLocation","addPopupToClick","popup","setLatLng","openOn"],"mappings":"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","file":"src\\App.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import L from \"leaflet\";\r\nimport firebase from \"firebase\";\r\nimport \"./style.scss\";\r\nimport \"leaflet-offline\";\r\nimport localforage from \"localforage\";\r\nimport logoImg from \"./ORCL-logo-cropped.png\";\r\nimport leafletKnn from \"leaflet-knn\";\r\nimport fontello_ttf from \"./fontello/font/fontello.ttf\";\r\nrequire(\"./L.Control.Sidebar\");\r\nrequire(\"./L.Control.Locate.min\");\r\nimport { tilesDb } from \"./offline-tiles-module.js\";\r\nimport { User } from \"./User.js\";\r\n//import { djsModmyFunc } from \"./djs_module.js\";\r\n\r\nconst myMap = {\r\n  setupBaseLayer: function() {\r\n    this.greyscaleLayer = L.tileLayer.offline(\r\n      App.State.settings.mbUrl,\r\n      tilesDb,\r\n      {\r\n        id: \"mapbox.light\",\r\n        attribution: App.State.settings.mbAttr,\r\n        maxZoom: 26,\r\n        maxNativeZoom: 18\r\n      }\r\n    );\r\n    this.streetsLayer = L.tileLayer.offline(App.State.settings.mbUrl, tilesDb, {\r\n      id: \"mapbox.streets\",\r\n      attribution: App.State.settings.mbAttr,\r\n      maxZoom: 26,\r\n      maxNativeZoom: 18\r\n    });\r\n    this.streetsLayer.on(\"offline:save-end\", function() {\r\n      alert(\"All the tiles were saved.\");\r\n    });\r\n\r\n    this.satLayer = L.tileLayer.offline(App.State.settings.mbUrl, tilesDb, {\r\n      id: \"mapbox.satellite\",\r\n      attribution: App.State.settings.mbAttr,\r\n      maxZoom: 26,\r\n      minZoom: 14\r\n    });\r\n    this.myLayerGroup = L.layerGroup();\r\n\r\n    const map = L.map(\"map\", {\r\n      center: App.State.settings.map.defaultCenter,\r\n      zoom: App.State.settings.map.defaultZoom,\r\n      maxZoom: App.State.settings.map.maxZoom,\r\n      minZoom: App.State.settings.map.minZoom,\r\n      zoomDelta: App.State.settings.map.zoomDelta,\r\n      layers: [this.streetsLayer, this.myLayerGroup] // loads with this layer initially\r\n    });\r\n    // create group of basemap layers\r\n    let baseMaps = {\r\n      Greyscale: this.greyscaleLayer,\r\n      Streets: this.streetsLayer,\r\n      Satellite: this.satLayer\r\n    };\r\n\r\n    this.overlayMaps = {\r\n      myLayers: this.myLayerGroup\r\n    };\r\n    this.LayersControl = L.control.layers(baseMaps).addTo(map);\r\n    return map;\r\n  }\r\n};\r\n\r\n// the App object holds the GeoJSON layer and manages all it's interactions with the user\r\nexport const App = {\r\n  State: {\r\n    settings: {\r\n      map: {\r\n        defaultCenter: [51.4384332, -0.3147865], // Ham\r\n        defaultZoom: 18,\r\n        maxZoom: 26,\r\n        minZoom: 12,\r\n        zoomDelta: 2\r\n      },\r\n      symbology: {\r\n        taskCompleteStyle: {\r\n          fillColor: \"grey\",\r\n          color: \"black\",\r\n          weight: 1\r\n        },\r\n        pointTaskNotCompleteStyle: {\r\n          fillColor: \"yellow\",\r\n          color: \"red\"\r\n        },\r\n        lineTaskNotCompleteStyle: {\r\n          fillColor: \"yellow\",\r\n          color: \"red\",\r\n          weight: 12\r\n        },\r\n        polyTaskNotCompleteStyle: {\r\n          fillColor: \"yellow\",\r\n          color: \"red\",\r\n          weight: 1\r\n        }\r\n      },\r\n      mbAttr:\r\n        '<a href=\"http://openstreetmap.org\">OSMap</a> ©<a href=\"http://mapbox.com\">Mapbox</a>',\r\n      mbUrl:\r\n        \"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGFuc2ltbW9ucyIsImEiOiJjamRsc2NieTEwYmxnMnhsN3J5a3FoZ3F1In0.m0ct-AGSmSX2zaCMbXl0-w\",\r\n      uploadjsonURL: \"https://geo.danieljsimmons.uk/dan1/upload/uploadjson.php\",\r\n      editform: {\r\n        assetConditionOptions: [6, 5, 4, 3, 2, 1, \"n/a\"]\r\n      }\r\n    },\r\n    relatedData: {}, // init va3l\r\n    latestLocation: null, // lat Lng\r\n    relDataSyncStatus: {}, // objects holds relatedData sync status flag for each feature, TRUE if synced , False\r\n    surveyed: {}, // true when inspected ie completed , false when not-yet-instected\r\n    completedResetDate: new Date(2018, 9, 1, 0, 0, 0, 0),\r\n    symbology: {\r\n      uncompletedColor: \"red\",\r\n      uncompletedfillColor: \"red\",\r\n      uncompletedLineWeight: 8,\r\n      completedLineWeight: 4,\r\n      uncompletedRadius: 8,\r\n      completedColor: \"grey\",\r\n      completedFillColor: \"grey\",\r\n      completedRadius: 2\r\n    },\r\n    visableFeatures: [],\r\n    formFields: {\r\n      condition: {\r\n        null: \"\",\r\n        c1: \"(1 - hazard)\",\r\n        c2: \"2 - (unfit for purpose)\",\r\n        c3: \"3\",\r\n        c4: \"4\",\r\n        c5: \"5\",\r\n        c6: \"6\",\r\n        rm: \"removed / not found\",\r\n        nv: \"not visable\",\r\n        pv: \"partially visable\"\r\n      }\r\n    },\r\n    AddPointButtonsPoints: [\r\n      { label: \"Hazard\", id: \"hazard\" },\r\n      { label: \"Unmapped asset\", id: \"unmappedAsset\" },\r\n      { label: \"general comment\", id: \"comment\" }\r\n    ],\r\n    AddPointButtonsLines: [\r\n      { label: \"Hazard\", id: \"hazard\" },\r\n      { label: \"Unmapped asset\", id: \"unmappedAsset\" },\r\n      { label: \"General comment\", id: \"comment\" },\r\n      { label: \"Breach in barrier\", id: \"breach\" }\r\n    ]\r\n  },\r\n\r\n  populateInputOptions: (el, items) => {\r\n    Object.keys(items).forEach(key => {\r\n      const option = document.createElement(\"option\");\r\n      option.value = key;\r\n      option.text = items[key];\r\n      el.add(option);\r\n    });\r\n  },\r\n\r\n  updateRelDataSyncMsg: (syncStatus, el) => {\r\n    if (el == null) return; //exit if element doesn yet exist ie of form is'nt open\r\n    let msg = \"\";\r\n    if (syncStatus == null) {\r\n      msg = \"no related data\";\r\n    } else if (syncStatus == true) {\r\n      msg = \"successful sync\";\r\n    } else if (syncStatus == false) {\r\n      msg =\r\n        \"Data not yet synced - please connect to network before closing this App\";\r\n    }\r\n    el.innerHTML = msg;\r\n    el.style = \"color:'CornflowerBlue' \";\r\n  },\r\n\r\n  whenGeoFeatureClicked: function() {\r\n    const fId =\r\n      App.selectedFeature.properties.OBJECTID +\r\n      App.selectedFeature.geometry.type;\r\n\r\n    function renderSideBar() {\r\n      App.sidebar.setContent(\r\n        document.getElementById(\"form-template\").innerHTML\r\n      );\r\n    }\r\n    const p = App.selectedFeature.properties;\r\n    renderSideBar();\r\n    this.generateFeatureEditFormElements(\r\n      p,\r\n      document.getElementById(\"fields-section\")\r\n    );\r\n    if (!!p.photo) this.getPhoto(p.photo);\r\n    App.updateRelDataSyncMsg(\r\n      App.State.relDataSyncStatus[fId],\r\n      document.getElementById(\"rel-data-sync-message\")\r\n    );\r\n    App.updateSidebarRelatedFromState(\r\n      fId,\r\n      document.getElementById(\"latest-related\"),\r\n      App.State.relatedData\r\n    );\r\n    App.populateInputOptions(\r\n      document.getElementById(\"related-data-condition\"),\r\n      App.State.formFields.condition\r\n    );\r\n    App.sidebar.show();\r\n  },\r\n\r\n  findNearestFeatures: function() {\r\n    if (App.State.latestLocation) {\r\n      const nearest = leafletKnn(App.geoLayer).nearest(\r\n        L.latLng(App.State.latestLocation),\r\n        1\r\n      );\r\n      nearest[0].layer.fire(\"click\");\r\n    } else {\r\n      window.alert(\"Sorry - GPS lock needed first \");\r\n    }\r\n  },\r\n\r\n  generateFeatureEditFormElements: (props, sectionEl) => {\r\n    sectionEl.innerHTML = null;\r\n    const createFormItem = (parentTag, el, type, prop, value) => {\r\n      const createWrapperDiv = () => {\r\n        const x = document.createElement(\"tr\");\r\n        parentTag.appendChild(x);\r\n        return x;\r\n      };\r\n      const createValueLabel = parent => {\r\n        const x = document.createElement(\"td\");\r\n        x.innerHTML = value;\r\n        parent.appendChild(x);\r\n        if (type === \"Checkbox\") {\r\n          x.checked = value;\r\n        }\r\n        parent.appendChild(x);\r\n      };\r\n\r\n      const createLabel = parent => {\r\n        const x = document.createElement(\"td\");\r\n        x.innerHTML = prop;\r\n        parent.appendChild(x);\r\n      };\r\n\r\n      const createRow = parent => {\r\n        const x = document.createElement(\"div\");\r\n        x.innerHTML = prop + \" \" + value + \"<br>\";\r\n        parent.appendChild(x);\r\n      };\r\n\r\n      const wrapperDiv = createWrapperDiv(parentTag);\r\n      createLabel(wrapperDiv, el, type, prop, value);\r\n      createValueLabel(wrapperDiv, el, type, prop, value);\r\n    };\r\n\r\n    const createFormItems = Object.keys(props).forEach(key => {\r\n      const propType = typeof props[key];\r\n      if (propType === \"string\" || propType === \"number\") {\r\n        createFormItem(sectionEl, \"Input\", \"text\", key, props[key]);\r\n      } else if (propType === \"boolean\") {\r\n        createFormItem(sectionEl, \"Input\", \"Checkbox\", key, props[key]);\r\n      }\r\n    });\r\n  },\r\n\r\n  resetMap: () => {\r\n    localStorage.removeItem(\"geoJSON\");\r\n    App.geoLayer = {};\r\n  },\r\n  getPhoto: photoURL => {\r\n    fetch(photoURL)\r\n      .then(res => res.blob()) // Gets the response and returns it as a blob\r\n      .then(blob => {\r\n        const objectURL = URL.createObjectURL(blob);\r\n        const myImage = new Image(350);\r\n        myImage.src = objectURL;\r\n        myImage.css = \"width:500px\";\r\n        document.getElementById(\"photo-div\").appendChild(myImage);\r\n      });\r\n  },\r\n\r\n  initSettingsControl: () => {\r\n    L.Control.myControl = L.Control.extend({\r\n      onAdd: e => {\r\n        const myControl_div = L.DomUtil.create(\r\n          \"button\",\r\n          \"main-button-control btn btn-lg btn-danger icon-cog\"\r\n        );\r\n        myControl_div.innerHTML = \"\";\r\n        myControl_div.title = \"Settings\";\r\n        myControl_div.onclick = () => {\r\n          App.sidebar.setContent(\r\n            document.getElementById(\"settings-template\").innerHTML\r\n          );\r\n          User().initLoginForm();\r\n          if (!!App.geoLayer) App.populateMapMeta();\r\n\r\n          document\r\n            .getElementById(\"open-new-project-button\")\r\n            .addEventListener(\"click\", function() {\r\n              loadMyLayer(\"dummy\");\r\n            });\r\n          App.sidebar.show();\r\n        };\r\n        return myControl_div;\r\n      }\r\n    });\r\n    L.control.myControl = opts => {\r\n      return new L.Control.myControl(opts);\r\n    };\r\n    L.control\r\n      .myControl({\r\n        position: \"bottomleft\"\r\n      })\r\n      .addTo(Map);\r\n  },\r\n\r\n  populateMapMeta: function() {\r\n    const container = document.getElementById(\"map-info-section\");\r\n    let content = \"\";\r\n    for (const item in App.mapMeta) {\r\n      if (!!item) {\r\n        content += String(item + \": \" + App.mapMeta[item] + \"<br>\");\r\n      }\r\n    }\r\n    container.innerHTML = content;\r\n  },\r\n\r\n  busyWorkingIndicator: busyWorking => {\r\n    const cogIcon = document.getElementsByClassName(\"icon-cog\")[0];\r\n    busyWorking\r\n      ? cogIcon.classList.add(\"icon-cog-spin\")\r\n      : cogIcon.classList.remove(\"icon-cog-spin\");\r\n  },\r\n\r\n  retrieveMapFromFireBase: function(index) {\r\n    let nodePath = String(\"/App/Maps/\" + index);\r\n    App.sidebar.hide();\r\n    App.busyWorkingIndicator(true);\r\n    fbDatabase\r\n      .ref(nodePath)\r\n      .once(\"value\")\r\n      .then(snapshot => {\r\n        const mapData = snapshot.val();\r\n        App.clearLocalStorageMaps();\r\n        App.setupGeoLayer(index, mapData);\r\n        document.getElementById(\"opennewproject\").style.display = \"none\";\r\n        App.busyWorkingIndicator(false);\r\n      })\r\n      .catch(err => {\r\n        console.log(\"Error! cannot retrieve mapdata from firebase:\", err);\r\n        App.busyWorkingIndicator(false);\r\n      });\r\n  },\r\n\r\n  saveMapToLocalStorage: (myKey, mapData) => {\r\n    localStorage.setItem(\"mapData.\" + myKey, JSON.stringify(mapData));\r\n  },\r\n\r\n  clearLocalStorageMaps: () => {\r\n    const keys = App.getLocalStorageMapDataKey();\r\n    keys.map(item => {\r\n      localStorage.removeItem(item);\r\n    });\r\n  },\r\n\r\n  clearLocalStorageLatestRelDataBackup: () => {\r\n    localStorage.removeItem(\"latestRelDataBackup\");\r\n  },\r\n\r\n  populateRelated: related => {\r\n    if (!related) return;\r\n    const relDataObject = {}; // to be replaced with State etc\r\n    const relDataSyncObject = {}; // just to make sure it's initially empty\r\n    const getLastRelDataItem = RelDataSet => {\r\n      const sortedKeys = Object.keys(RelDataSet).sort();\r\n      const lastDataItem = RelDataSet[sortedKeys[sortedKeys.length - 1]];\r\n      return lastDataItem;\r\n    };\r\n    App.State.relatedData = Object.keys(related).map((relKey, index) => {\r\n      const itemOb = {};\r\n      const lastItem = getLastRelDataItem(related[relKey]);\r\n      itemOb[relKey] = lastItem;\r\n      relDataObject[relKey] = lastItem;\r\n      relDataSyncObject[relKey] = true; // ie the feature's rela data is now synced\r\n      return itemOb;\r\n    });\r\n    App.getRelDataFromLocalStorage(App.mapHash);\r\n    return { relDataObject, relDataSyncObject };\r\n  },\r\n\r\n  getRelDataFromLocalStorage: mapHash => {\r\n    const regex = \"backup.relatedData.\" + mapHash + \".\";\r\n    const relDataKeys = Object.keys(localStorage).filter(item =>\r\n      item.match(regex)\r\n    );\r\n    if (relDataKeys.length == 0) return;\r\n    relDataKeys.map(key => {\r\n      const item = JSON.parse(localStorage.getItem(key));\r\n      const itemFeatureKey = key.split(regex)[1]; //  element 1 is str after split point\r\n      const relDataFeaturePath =\r\n        \"App/Maps/\" + mapHash + \"/Related/\" + itemFeatureKey;\r\n      const localStorageTime = new Date(item.timestamp);\r\n      const stateTime = new Date(\r\n        App.State.relatedData[itemFeatureKey].timestamp\r\n      );\r\n      if (localStorageTime.getTime() > stateTime.getTime()) {\r\n        console.log(\r\n          \"New item to upload! : \",\r\n          itemFeatureKey,\r\n          item.timestamp,\r\n          \"State Timestamp:\",\r\n          App.State.relatedData[itemFeatureKey].timestamp\r\n        );\r\n        App.updateFeatureRelatedState(itemFeatureKey, item);\r\n        App.State.relDataSyncStatus[key] = false; // while item is sucessfully pushed to db\r\n        RelatedData.pushRelatedDataRecord(\r\n          relDataFeaturePath,\r\n          itemFeatureKey,\r\n          item\r\n        );\r\n        // Trigger push of item (does this update sync status and message automatically ? )\r\n      }\r\n    });\r\n  },\r\n\r\n  updateFeatureRelatedState: (featureKey, relatedData) => {\r\n    // update a single feature's RelatedRecord State\r\n    App.State.relatedData[featureKey] = relatedData;\r\n  },\r\n\r\n  setCompletedStyle: (\r\n    featureOb,\r\n    layerOb,\r\n    objectID,\r\n    ObjectType,\r\n    isCompleted,\r\n    relatedData,\r\n    completedResetDate,\r\n    symbology\r\n  ) => {\r\n    const featureKey = objectID + ObjectType; // strings\r\n    if (relatedData[featureKey] !== undefined) {\r\n      var relDataDate = new Date(Date.parse(relatedData[featureKey].timestamp));\r\n      const refDate = completedResetDate.getTime();\r\n      var relDate = relDataDate.getTime();\r\n      if (relDataDate > completedResetDate) {\r\n        layerOb.setStyle({\r\n          color: symbology.completedColor, // why not working??\r\n          fillColor: symbology.completedFillColor,\r\n          weight: symbology.completedLineWeight,\r\n          radius: 1\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  updateSidebarRelatedFromState: (featureKey, reldiv, relatedData) => {\r\n    // update a feature's RelatedRecord State\r\n    reldiv.innerHTML = \"\";\r\n    const relSet = relatedData[featureKey];\r\n    if (relSet) {\r\n      Object.keys(relSet).map(key => {\r\n        reldiv.innerHTML += key + \": \" + relSet[key] + \"<br>\";\r\n      });\r\n    } else reldiv.innerHTML = \"\";\r\n  },\r\n\r\n  setupGeoLayer: (key, mapData) => {\r\n    // TODO: major refactor needed to make functional\r\n    App.mapMeta = mapData.meta;\r\n    App.mapHash = key;\r\n    myMap.myLayerGroup.clearLayers(App.geoLayer);\r\n    const featureLabelField = mapData.Meta\r\n      ? mapData.Meta.LabelProperty\r\n      : \"Asset\";\r\n    const relData = App.populateRelated(mapData.Related); // need to catch when no related available\r\n    if (!!relData) {\r\n      App.State.relatedData = relData.relDataObject;\r\n      App.State.relDataSyncStatus = relData.relDataSyncObject;\r\n    } else {\r\n      App.State.relatedData = {};\r\n      App.State.relDataSyncStatus = {};\r\n    }\r\n    App.geoLayer = L.geoJson(mapData.Geo, {\r\n      onEachFeature: (feature, layer) => {\r\n        let featureLabel = feature.properties[featureLabelField];\r\n        App.setCompletedStyle(\r\n          feature,\r\n          layer,\r\n          feature.properties[\"OBJECTID\"],\r\n          feature.geometry.type,\r\n          true,\r\n          App.State.relatedData,\r\n          App.State.completedResetDate,\r\n          App.State.symbology\r\n        );\r\n\r\n        let featureContentPopup = \"\";\r\n        let addNoteButtonContent = \"\";\r\n        featureContentPopup = `<div class=\"btn btn-primary large icon-pencil\" onClick=\"App.whenGeoFeatureClicked();\"><br>\r\n          ${featureLabel} </div>`;\r\n        if (feature.geometry.type == \"LineString\") {\r\n          addNoteButtonContent = App.createPopupContentButtonSet(\r\n            App.State.AddPointButtonsLines\r\n          );\r\n        }\r\n        layer.bindPopup(featureContentPopup + addNoteButtonContent);\r\n        layer.on(\"click\", e => {\r\n          if (App.selectedLayer !== layer) {\r\n            if (App.selectedLayer) {\r\n              App.unsetSelectedStyle();\r\n            }\r\n            App.State.symbology.beforeSelectedColor = layer.options.color;\r\n            App.State.symbology.beforeSelectedFillColor =\r\n              layer.options.fillColor;\r\n            App.State.symbology.beforeSelectedLineWeight = layer.options.weight;\r\n\r\n            // now reset the style of the old layer\r\n          }\r\n          App.selectedFeature = feature; // expose selected feature and layer\r\n          App.selectedLayer = layer;\r\n          App.selectedLayer.setStyle({\r\n            color: \"blue\",\r\n            fillColor: \"blue\",\r\n            weight: 2\r\n          });\r\n        });\r\n      },\r\n      style: feature => {\r\n        return {\r\n          fillOpacity: 0.4,\r\n          color: App.State.symbology.uncompletedColor,\r\n          fillColor: App.State.symbology.uncompletedFillColor,\r\n          weight: App.State.symbology.uncompletedLineWeight\r\n        };\r\n      },\r\n      pointToLayer: (feature, latlng) => {\r\n        return L.circleMarker(latlng, {\r\n          radius: App.State.symbology.uncompletedRadius,\r\n          stroke: true,\r\n          weight: 3,\r\n          opacity: 1,\r\n          fillOpacity: 1\r\n        });\r\n      },\r\n      interactive: true\r\n    });\r\n    myMap.myLayerGroup.addLayer(App.geoLayer);\r\n    Map.fitBounds(App.geoLayer.getBounds());\r\n    App.movePolygonsToBack();\r\n    App.saveMapToLocalStorage(key, mapData);\r\n  },\r\n\r\n  unsetSelectedStyle: () => {\r\n    if (!App.selectedLayer) return;\r\n    App.selectedLayer.setStyle({\r\n      color: App.State.symbology.beforeSelectedColor,\r\n      fillColor: App.State.symbology.beforeSelectedFillColor,\r\n      weight: App.State.symbology.beforeSelectedLineWeight\r\n    });\r\n  },\r\n\r\n  movePolygonsToBack() {\r\n    //move polygons to back\r\n    App.geoLayer.eachLayer(layer => {\r\n      if (layer.feature.geometry.type == \"Polygon\") {\r\n        layer.bringToBack();\r\n      }\r\n    });\r\n  },\r\n\r\n  getLocalStorageMapDataKey: () => {\r\n    // return keys that start with maoData\r\n    return Object.keys(localStorage).filter(item => {\r\n      return new RegExp(\"^mapData.*\").test(item);\r\n    });\r\n  },\r\n\r\n  loadMapDataFromLocalStorage: () => {\r\n    // attempt to retrieve map from local\r\n    const storageKey = App.getLocalStorageMapDataKey();\r\n    if (storageKey.length == 0) {\r\n      return;\r\n    }\r\n    const mapData = JSON.parse(localStorage.getItem(storageKey));\r\n    const mapKey = storageKey[0].split(\"mapData.\")[1];\r\n    App.setupGeoLayer(mapKey, mapData);\r\n  },\r\n\r\n  addPointForm: buttonSetType => {\r\n    const sidebarContent = `\r\n    <h3>Add point </h3>\r\n    type: ${buttonSetType}\r\n    <p>  <textarea class=\"form-control\" rows=\"2\" id=\"add-point-comment\" placeholder = \"optional comment here ...\"></textarea></p>\r\n    <p><button class=\"btn btn-primary\">Add photo</button></p><hr>\r\n    <p><button class=\"btn btn-primary\">Submit </button> </p>`;\r\n    App.sidebar.setContent(sidebarContent);\r\n    App.sidebar.show();\r\n  },\r\n\r\n  createPopupContentButtonSet: buttonSet => {\r\n    let popupContent = `<div class='dropdown'>\r\n    <button class='btn btn-primary left-spacing'>Add point ...\r\n    </button> <div class='dropdown-content'>`;\r\n    const createButtons = buttonSet.map(button => {\r\n      popupContent += `<button onclick=\"App.addPointForm('${button.id}')\"\r\n       class=\"btn btn-primary dropdown-button\" >${button.label}</button>`;\r\n    });\r\n    popupContent += `</div></div>`;\r\n    return popupContent;\r\n  },\r\n\r\n  featureLabels: () => {\r\n    // TODO: refactor to functional\r\n    const bounds = Map.getBounds();\r\n    if (App.State.visableFeatures !== null) {\r\n      App.State.visableFeatures.map(layer => {\r\n        layer.unbindTooltip();\r\n      });\r\n      App.State.visableFeatures = [];\r\n    }\r\n    if (Map.getZoom() < 20) {\r\n      return;\r\n    }\r\n    const redrawToolTips = () => {\r\n      App.geoLayer.eachLayer(layer => {\r\n        let relID = \"\";\r\n        let hasRelData;\r\n        try {\r\n          relID =\r\n            layer.feature.properties.OBJECTID + layer.feature.geometry.type;\r\n          hasRelData = App.State.relatedData[relID];\r\n        } catch (err) {\r\n          relID = undefined;\r\n          hasRelData = false;\r\n        }\r\n\r\n        if (layer.getLatLng && !hasRelData) {\r\n          if (bounds.contains(layer.getLatLng())) {\r\n            App.State.visableFeatures.push(layer);\r\n          }\r\n        } else if (layer.getBounds && !hasRelData) {\r\n          if (\r\n            bounds.intersects(layer.getBounds()) ||\r\n            bounds.contains(layer.getBounds())\r\n          ) {\r\n            App.State.visableFeatures.push(layer);\r\n          }\r\n        }\r\n      });\r\n    };\r\n    redrawToolTips();\r\n    App.State.visableFeatures.map(layer => {\r\n      layer.bindTooltip(layer.feature.properties.Asset, {\r\n        permanent: true,\r\n        interactive: true\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nwindow.App = App;\r\n\r\nconst RelatedData = {\r\n  saveRelDataRecordToLocalStorage: (mapHash, featureKey, relatedData) => {\r\n    localStorage.setItem(\r\n      \"backup.relatedData.\" + mapHash + \".\" + featureKey,\r\n      JSON.stringify(relatedData)\r\n    );\r\n  },\r\n\r\n  pushRelatedDataRecord: (relDataPath, featureKey, relatedRecord) => {\r\n    fbDatabase\r\n      .ref(relDataPath) // meed to move this constant into App.State\r\n      .push(relatedRecord)\r\n      .then(snap => {\r\n        // if successfully synced\r\n        const f_id = snap.parent.key; // fudege to retrieve feature key\r\n        App.State.relDataSyncStatus[f_id] = true;\r\n        App.updateRelDataSyncMsg(\r\n          App.State.relDataSyncStatus[f_id],\r\n          document.getElementById(\"rel-data-sync-message\")\r\n        );\r\n        // Remove record from local storage\r\n        const localStorageKey =\r\n          \"backup.relatedData.\" + App.mapHash + \".\" + featureKey;\r\n        localStorage.removeItem(localStorageKey);\r\n      })\r\n      .catch(error => {\r\n        alert(\"Sorry - something went wrong - have you logged in etc?\");\r\n      });\r\n  },\r\n\r\n  submit: () => {\r\n    // calculate key from OBJECTID + geometrytype\r\n    RelatedData.featureKey = String(\r\n      App.selectedFeature.properties.OBJECTID +\r\n        App.selectedFeature.geometry.type\r\n    );\r\n\r\n    App.selectedFeature.geometry.type + \"/\";\r\n    RelatedData.nodePath = String(\r\n      //    \"App/Maps/\" + App.mapHash + \"/Related/\" + RelatedData.featureKey + \"/\"\r\n      `App/Maps/${App.mapHash}/Related/${RelatedData.featureKey}/`\r\n    );\r\n\r\n    const relatedRecord = {};\r\n    relatedRecord.timestamp = Date();\r\n    relatedRecord.user = firebase.auth().currentUser.displayName;\r\n    relatedRecord.condition = document.getElementById(\r\n      \"related-data-condition\"\r\n    ).value;\r\n    if (document.getElementById(\"related-data-comments\").value) {\r\n      relatedRecord.comments = document.getElementById(\r\n        \"related-data-comments\"\r\n      ).value;\r\n    }\r\n    if (document.getElementById(\"related-data-photo\").value) {\r\n      relatedRecord.photo = document.getElementById(\"related-data-photo\").value;\r\n    }\r\n    const key = RelatedData.featureKey;\r\n    App.State.relDataSyncStatus[key] = false; // while push promise is unresolved\r\n    App.updateRelDataSyncMsg(\r\n      App.State.relDataSyncStatus[key],\r\n      document.getElementById(\"rel-data-sync-message\")\r\n    );\r\n    App.updateFeatureRelatedState(key, relatedRecord);\r\n\r\n    App.updateSidebarRelatedFromState(\r\n      key,\r\n      document.getElementById(\"latest-related\"),\r\n      App.State.relatedData\r\n    );\r\n    //RelatedData.backupUpRelStateToLocalStorage()\r\n    RelatedData.saveRelDataRecordToLocalStorage(\r\n      App.mapHash,\r\n      key,\r\n      relatedRecord\r\n    );\r\n    // RelatedData.backupUpRelStateToLocalStorage();\r\n    RelatedData.pushRelatedDataRecord(RelatedData.nodePath, key, relatedRecord);\r\n    document.getElementById(\"related-data-info\").innerHTML = \"Submitted!\";\r\n    App.State.symbology.beforeSelectedColor =\r\n      App.State.symbology.completedColor;\r\n    App.State.symbology.beforeSelectedFillColor =\r\n      App.State.symbology.completedFillColor;\r\n  },\r\n\r\n  backupUpRelStateToLocalStorage: () => {\r\n    localStorage.setItem(\r\n      \"latestRelDataBackup\",\r\n      JSON.stringify(App.State.relatedData)\r\n    );\r\n  },\r\n\r\n  restoreRelStateFromLocalStorage: () => {\r\n    if (localStorage.getItem(\"latestRelDataBackup\") !== null) {\r\n      App.State.relatedData = JSON.parse(\r\n        localStorage.getItem(\"latestRelDataBackup\")\r\n      );\r\n    } else {\r\n      App.State.relatedData = {};\r\n    }\r\n  },\r\n\r\n  addPhoto: function() {\r\n    const el = document.getElementById(\"photo-capture\");\r\n    document.getElementById(\"related-data-photo\").value = el.files[0].name;\r\n  }\r\n};\r\n\r\nwindow.RelatedData = RelatedData;\r\n\r\nfunction uploadMapToFirebase() {\r\n  // grab the blobal Mapindex, then send gson layer up to node\r\n  const nodePath = String(\"App/Maps/\" + App.mapHash + \"/Geo\");\r\n\r\n  fbDatabase\r\n    .ref(nodePath)\r\n    .set(App.geoLayer.toGeoJSON())\r\n    .catch(function(error) {\r\n      alert(\"Sorry you need to be logged in to do this\");\r\n    });\r\n}\r\n\r\nwindow.User = User;\r\nfunction loadMyLayer(layerName) {\r\n  // just for testing\r\n\r\n  document.getElementById(\"open-new-project-button\").style.display = \"none\";\r\n  //loadFromPresetButtons(layerName);\r\n  loadProject();\r\n\r\n  function loadProject() {\r\n    retriveMapIndexFromFirebase();\r\n\r\n    function retriveMapIndexFromFirebase() {\r\n      document.getElementById(\"message-area\").innerHTML =\r\n        \"<p>waiting for network connection ...</p>\";\r\n      fbDatabase\r\n        .ref(\"/App/Mapindex\")\r\n        .once(\"value\")\r\n        .then(snapshot => {\r\n          document.getElementById(\"message-area\").innerHTML = null;\r\n          const el = document.getElementById(\"opennewproject\");\r\n          el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n          displayMapIndeces(snapshot.val());\r\n        })\r\n        .catch(error => {\r\n          document.getElementById(\"message-area\").innerHTML =\r\n            \"Sorry - \" + error.message;\r\n        });\r\n    }\r\n\r\n    function displayMapIndeces(mapIndexList) {\r\n      const el = document.getElementById(\"opennewproject\");\r\n      el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n      Object.values(mapIndexList).map(item => {\r\n        const btn = document.createElement(\"button\");\r\n        btn.setAttribute(\"value\", item.mapID);\r\n        btn.setAttribute(\"title\", item.description);\r\n        btn.className = \"btn btn-primary open-project-button\";\r\n        const id = item.mapID;\r\n        btn.addEventListener(\"click\", e => {\r\n          App.retrieveMapFromFireBase(e.target.value);\r\n          App.State.settings.mapIndex = e.target.value; // store map Index\r\n        });\r\n        btn.innerHTML = item.name;\r\n        maplist.appendChild(btn);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction initLogoWatermark() {\r\n  L.Control.watermark = L.Control.extend({\r\n    onAdd: e => {\r\n      const watermark = L.DomUtil.create(\"IMG\", \"watermark\");\r\n      watermark.src = \"ORCL-logo-cropped.png\";\r\n      watermark.style.opacity = 0.3;\r\n      return watermark;\r\n    }\r\n  });\r\n  L.control.watermark = opts => {\r\n    return new L.Control.watermark(opts);\r\n  };\r\n  L.control.watermark({ position: \"bottomright\" }).addTo(Map);\r\n}\r\n\r\n// --------------------------------- Offline Basemap Caching ------\r\nconst setupOfflineBaseLayerControls = () => {\r\n  const myBaseLayerControls = [\r\n    {\r\n      object: myMap.streetsLayer,\r\n      label: \"colour streets\",\r\n      class: \"streets-offline-control\"\r\n    },\r\n    {\r\n      object: myMap.greyscaleLayer,\r\n      label: \"Greyscale\",\r\n      class: \"greyscale-offline-control\"\r\n    },\r\n\r\n    {\r\n      object: myMap.satLayer,\r\n      label: \"Satellite\",\r\n      class: \"satellite-offline-control\"\r\n    }\r\n  ];\r\n\r\n  return myBaseLayerControls.map(layer => {\r\n    return L.control.offline(layer.object, tilesDb, {\r\n      saveButtonHtml: `<i id=\"${layer.object}\" title=\"Save ${\r\n        layer.label\r\n      } layer to use offline\" class=\"${layer.class} layer icon-download\">${\r\n        layer.label\r\n      } </i>`,\r\n      removeButtonHtml: '<i class=\"icon-trash \" aria-hidden=\"true\">Delete</i>',\r\n      confirmSavingCallback: function(nTilesToSave, continueSaveTiles) {\r\n        if (window.confirm(\"Save \" + nTilesToSave + \" background tiles?\")) {\r\n          continueSaveTiles();\r\n        }\r\n      },\r\n      confirmRemovalCallback: function(continueRemoveTiles) {\r\n        if (window.confirm(\"Delete All offline tiles?\")) {\r\n          continueRemoveTiles();\r\n        }\r\n      },\r\n      minZoom: 14,\r\n      maxZoom: 18,\r\n      position: \"topright\"\r\n    });\r\n  });\r\n};\r\n\r\nL.Control.OfflineBaselayersControl = L.Control.extend({\r\n  onAdd: function(map) {\r\n    const OfflineBaselayersControl_div = L.DomUtil.create(\r\n      \"button\",\r\n      \"btn btn-sm icon-download btn-info\"\r\n    );\r\n    OfflineBaselayersControl_div.innerHTML = \"Offline <br>Baselayers\";\r\n    OfflineBaselayersControl_div.title =\r\n      \"Save Background layers (tiles) for Offline use\";\r\n    OfflineBaselayersControl_div.onclick = () => {\r\n      const offlineLayerCtrls = document.querySelectorAll(\r\n        \".leaflet-control-offline\"\r\n      );\r\n      if (offlineLayerCtrls[0].style.display == \"none\") {\r\n        offlineLayerCtrls.forEach(el => (el.style.display = \"block\"));\r\n      } else {\r\n        offlineLayerCtrls.forEach(el => (el.style.display = \"none\"));\r\n      }\r\n    };\r\n    return OfflineBaselayersControl_div;\r\n  }\r\n});\r\nL.control.OfflineBaselayersControl = opts => {\r\n  return new L.Control.OfflineBaselayersControl(opts);\r\n};\r\n\r\nconst fireBaseconfig = {\r\n  apiKey: \"AIzaSyB977vJdWTGA-JJ03xotQkeu8X4_Ds_BLQ\",\r\n  authDomain: \"fir-realtime-db-24299.firebaseapp.com\",\r\n  databaseURL: \"https://fir-realtime-db-24299.firebaseio.com\",\r\n  projectId: \"fir-realtime-db-24299\",\r\n  storageBucket: \"fir-realtime-db-24299.appspot.com\",\r\n  messagingSenderId: \"546067641349\"\r\n};\r\n\r\nvar Map = {};\r\nvar fbDatabase = {};\r\nvar offlineLayerControls = {};\r\nconst initApp = () => {\r\n  App.State.relatedData = {};\r\n  App.State.visableFeatures = [];\r\n  App.State.symbology.beforeSelectedColor = {};\r\n  App.State.symbology.beforeSelectedFillColor = {};\r\n  firebase.initializeApp(fireBaseconfig);\r\n  fbDatabase = firebase.database();\r\n\r\n  // --------------------------------------- Main ---------------------\r\n  Map = myMap.setupBaseLayer();\r\n  // initDebugControl()\r\n  initLogoWatermark();\r\n  L.control.scale({ position: \"bottomleft\" }).addTo(Map);\r\n  App.initSettingsControl();\r\n  setupSideBar();\r\n  initLocationControl();\r\n  Map.doubleClickZoom.disable();\r\n  L.control.OfflineBaselayersControl({ position: \"topright\" }).addTo(Map);\r\n  offlineLayerControls = setupOfflineBaseLayerControls();\r\n  offlineLayerControls.map(layer => {\r\n    layer.addTo(Map);\r\n  });\r\n  document.querySelectorAll(\".leaflet-control-offline\").forEach(el => {\r\n    el.style.display = \"none\";\r\n  });\r\n  //RelatedData.restoreRelStateFromLocalStorage()\r\n  App.loadMapDataFromLocalStorage();\r\n  window.alert(\"ORCL WebApp version 0.9.103\");\r\n\r\n  // ----- offline service worker -----------\r\n  if (\"serviceWorker\" in navigator) {\r\n    window.addEventListener(\"load\", () => {\r\n      navigator.serviceWorker\r\n        .register(\"sw.js\")\r\n        .then(registration => {})\r\n        .catch(registrationError => {\r\n          console.log(\"SW registration failed: \", registrationError);\r\n        });\r\n    });\r\n  }\r\n};\r\n\r\ninitApp();\r\n\r\n//  ------------------------  leaflet controls -------------\r\n\r\n// ------sidebar controll plugin\r\nfunction setupSideBar() {\r\n  App.sidebar = window.L.control.sidebar(\"sidebar\", {\r\n    position: \"left\",\r\n    closeButton: \"true\",\r\n    autoPan: false\r\n  });\r\n\r\n  Map.addControl(App.sidebar);\r\n}\r\n\r\n// -------------------- GPS location plugin\r\nfunction initLocationControl() {\r\n  App.lc = L.control\r\n    .locate({\r\n      position: \"topright\",\r\n      keepCurrentZoomLevel: true,\r\n      strings: {\r\n        title: \"My location (will use GPS if available)\"\r\n      },\r\n      cacheLocation: false,\r\n      locateOptions: {\r\n        enableHighAccuracy: true,\r\n        timeout: 10000,\r\n        maximumAge: 3000\r\n        //watch: true\r\n      },\r\n      icon: \"icon-direction\"\r\n    })\r\n    .addTo(Map);\r\n}\r\n\r\nMap.on(\"locationfound\", updateLatestLocation);\r\n\r\nMap.on(\"click\", e => {\r\n  App.unsetSelectedStyle();\r\n  App.selectedLayer = null;\r\n  App.selectedFeature = null;\r\n});\r\n\r\nMap.on(\"dblclick\", e => {\r\n  const addPopupToClick = e => {\r\n    L.popup()\r\n      .setLatLng(e.latlng)\r\n      .setContent(\r\n        App.createPopupContentButtonSet(App.State.AddPointButtonsPoints)\r\n      )\r\n      .openOn(Map);\r\n  };\r\n  addPopupToClick(e);\r\n});\r\n\r\nMap.on(\"moveend\", () => {\r\n  App.featureLabels();\r\n});\r\n\r\nfunction updateLatestLocation(e) {\r\n  App.State.latestLocation = e.latlng;\r\n}\r\n","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\leaflet\\\\dist\\\\leaflet-src.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\leaflet-knn\\\\index.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\firebase\\\\dist\\\\index.cjs.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\leaflet-offline\\\\src\\\\leaflet-offline.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\localforage\\\\dist\\\\localforage.js\");"],"sourceRoot":""}