{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/app.js","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\leaflet\\\\dist\\\\leaflet-src.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\leaflet-knn\\\\index.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\firebase\\\\dist\\\\index.cjs.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\leaflet-offline\\\\src\\\\leaflet-offline.js\"","webpack:///external \"..\\\\..\\\\..\\\\node_modules\\\\localforage\\\\dist\\\\localforage.js\""],"names":["require","myOb","myFunc","hello","myMap","settings","symbology","taskCompleteStyle","fillColor","color","weight","pointTaskNotCompleteStyle","lineTaskNotCompleteStyle","polyTaskNotCompleteStyle","mbAttr","mbUrl","uploadjsonURL","editform","assetConditionOptions","state","latestLocation","setupBaseLayer","greyscaleLayer","L","tileLayer","offline","tilesDb","id","attribution","maxZoom","maxNativeZoom","streetsLayer","on","alert","satLayer","minZoom","myLayerGroup","layerGroup","map","center","zoom","zoomDelta","layers","baseMaps","Greyscale","Streets","Satellite","basemaps","overlayMaps","myLayers","overlayMap","LayersControl","control","addTo","App","State","relatedData","relDataSyncStatus","surveyed","completedResetDate","Date","uncompletedColor","uncompletedfillColor","uncompletedLineWeight","completedLineWeight","uncompletedRadius","completedColor","completedFillColor","completedRadius","visableFeatures","formFields","condition","null","c1","c2","c3","c4","c5","c6","rm","nv","pv","populateConditionInputField","conditionSelect","document","getElementById","Object","keys","forEach","key","option","createElement","value","text","add","updateRelDataSyncMsg","relSyncDiv","msg","s","featureID","innerHTML","style","whenGeoFeatureClicked","fId","selectedFeature","properties","OBJECTID","geometry","type","renderSideBar","sidebar","setContent","p","generateFormElements","photo","undefined","getPhoto","updateSidebarRelatedFromState","show","findNearestFeatures","nearest","geoLayer","latLng","layer","fire","window","createFormItem","parentTag","el","prop","wrapperDiv","createWrapperDiv","createLabel","createValueLabel","x","appendChild","parent","checked","createRow","props","fs","propType","console","log","submitForm","readSidebarFormProperties","selectedLayer","setTooltipContent","Asset","hide","localStorage","setItem","JSON","stringify","toGeoJSON","String","saveFeatureToFirebase","confirm","featureIndex","_leaflet_id","_layers","nodePath","mapHash","Ob","myKey","fbDatabase","ref","update","then","catch","assignTaskCompletedStyle","featureProperty","taskCompleted","setStyle","feature","includes","resetMap","removeItem","photoURL","fetch","res","blob","objectURL","URL","createObjectURL","myImage","Image","src","css","uploadChanges","url","method","body","headers","error","response","initSettingsControl","Control","myControl","extend","onAdd","myControl_div","DomUtil","create","title","onclick","initLoginForm","populateMapMeta","addEventListener","loadMyLayer","opts","position","Map","container","content","item","mapMeta","busyWorkingIndicator","cogIcon","getElementsByClassName","busyWorking","classList","remove","retrieveMapFromFireBase","index","once","mapData","snapshot","val","clearLocalStorageMaps","setupGeoLayer","display","err","saveMapToLocalStorage","getLocalStorageMapDataKey","clearLocalStorageLatestRelDataBackup","populateRelated","related","relDataObject","relDataSyncObject","getLastRelDataItem","sortedKeys","RelDataSet","sort","lastDataItem","length","relKey","itemOb","lastItem","getRelDataFromLocalStorage","regex","relDataKeys","filter","match","parse","getItem","itemFeatureKey","split","relDataFeaturePath","localStorageTime","timestamp","stateTime","getTime","updateFeatureRelatedState","RelatedData","pushRelatedDataRecord","featureKey","setCompletedStyle","featureOb","layerOb","objectID","ObjectType","isCompleted","relDataDate","refDate","relDate","radius","reldiv","relSet","meta","clearLayers","featureLabelField","Meta","LabelProperty","Related","geoJson","Geo","onEachFeature","featureLabel","bindPopup","unsetSelectedStyle","beforeSelectedColor","options","beforeSelectedFillColor","beforeSelectedLineWeight","fillOpacity","uncompletedFillColor","pointToLayer","latlng","circleMarker","stroke","opacity","interactive","addLayer","fitBounds","getBounds","movePolygonsToBack","eachLayer","bringToBack","RegExp","test","loadMapDataFromLocalStorage","storageKey","mapKey","featureLabels","bounds","unbindTooltip","getZoom","redrawToolTips","relID","hasRelData","getLatLng","contains","push","intersects","bindTooltip","permanent","saveRelDataRecordToLocalStorage","relDataPath","relatedRecord","f_id","snap","localStorageKey","message","submit","user","firebase","auth","currentUser","displayName","comments","backupUpRelStateToLocalStorage","restoreRelStateFromLocalStorage","addPhoto","files","name","uploadMapToFirebase","set","User","layerName","loadProject","retriveMapIndexFromFirebase","insertAdjacentHTML","displayMapIndeces","mapIndexList","values","btn","description","setAttribute","mapID","className","e","target","mapIndex","maplist","initLogoWatermark","watermark","setupOfflineBaseLayerControls","myBaseLayerControls","object","label","class","saveButtonHtml","removeButtonHtml","confirmSavingCallback","nTilesToSave","continueSaveTiles","confirmRemovalCallback","continueRemoveTiles","OfflineBaselayersControl","OfflineBaselayersControl_div","offlineLayerCtrls","querySelectorAll","onRemove","fireBaseconfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","offlineLayerControls","initApp","initializeApp","database","scale","setupSideBar","initLocationControl","doubleClickZoom","disable","navigator","serviceWorker","register","registration","registrationError","closeButton","autoPan","addControl","lc","locate","keepCurrentZoomLevel","strings","cacheLocation","locateOptions","enableHighAccuracy","timeout","maximumAge","icon","updateLatestLocation"],"mappings":"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","file":"src\\app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\"use strict\";\r\n\r\nimport L from \"leaflet\";\r\nimport firebase from \"firebase\";\r\n//import \"./style.scss\";\r\nimport \"leaflet-offline\";\r\nimport localforage from \"localforage\";\r\n//import logoImg from \"./ORCL-logo-cropped.png\";\r\nimport leafletKnn from \"leaflet-knn\";\r\n//import fontello_ttf from \"./fontello/font/fontello.ttf\";\r\nrequire(\"./L.Control.Sidebar\");\r\nrequire(\"./L.Control.Locate.min\");\r\nimport { tilesDb } from \"./offline-tiles-module.js\";\r\nimport { User } from \"./User.js\";\r\nimport { djsModmyFunc } from \"./djs_module.js\";\r\n\r\nconst myOb = {\r\n  myFunc: () => {\r\n    const hello = () => \"hello\";\r\n  }\r\n};\r\n\r\nconst myMap = {\r\n  settings: {\r\n    symbology: {\r\n      taskCompleteStyle: {\r\n        fillColor: \"grey\",\r\n        color: \"black\",\r\n        weight: 1\r\n      },\r\n      pointTaskNotCompleteStyle: {\r\n        fillColor: \"yellow\",\r\n        color: \"red\"\r\n      },\r\n      lineTaskNotCompleteStyle: {\r\n        fillColor: \"yellow\",\r\n        color: \"red\",\r\n        weight: 12\r\n      },\r\n      polyTaskNotCompleteStyle: {\r\n        fillColor: \"yellow\",\r\n        color: \"red\",\r\n        weight: 1\r\n      }\r\n    },\r\n    mbAttr:\r\n      '<a href=\"http://openstreetmap.org\">OSMap</a> ©<a href=\"http://mapbox.com\">Mapbox</a>',\r\n    mbUrl:\r\n      \"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGFuc2ltbW9ucyIsImEiOiJjamRsc2NieTEwYmxnMnhsN3J5a3FoZ3F1In0.m0ct-AGSmSX2zaCMbXl0-w\",\r\n    uploadjsonURL: \"https://geo.danieljsimmons.uk/dan1/upload/uploadjson.php\",\r\n    editform: {\r\n      assetConditionOptions: [6, 5, 4, 3, 2, 1, \"n/a\"]\r\n    }\r\n  },\r\n  state: {\r\n    // Hopefully this is where all data will live, after the app is refactored to be more like React\r\n    latestLocation: null // lat Lng\r\n  },\r\n\r\n  setupBaseLayer: function() {\r\n    const greyscaleLayer = L.tileLayer.offline(this.settings.mbUrl, tilesDb, {\r\n      id: \"mapbox.light\",\r\n      attribution: myMap.settings.mbAttr,\r\n      maxZoom: 26,\r\n      maxNativeZoom: 18\r\n    });\r\n    const streetsLayer = L.tileLayer.offline(this.settings.mbUrl, tilesDb, {\r\n      id: \"mapbox.streets\",\r\n      attribution: myMap.settings.mbAttr,\r\n      maxZoom: 26,\r\n      //minNativeZoom: 22,\r\n      maxNativeZoom: 18 // was 20\r\n    });\r\n    streetsLayer.on(\"offline:save-end\", function() {\r\n      alert(\"All the tiles were saved.\");\r\n    });\r\n\r\n    const satLayer = L.tileLayer.offline(this.settings.mbUrl, tilesDb, {\r\n      id: \"mapbox.satellite\",\r\n      attribution: myMap.settings.mbAttr,\r\n      maxZoom: 26,\r\n      minZoom: 18\r\n    });\r\n    const myLayerGroup = L.layerGroup();\r\n    this.myLayerGroup = myLayerGroup;\r\n    // create map with 3 layers\r\n    const map = L.map(\"map\", {\r\n      center: [51.4384332, -0.3147865],\r\n      zoom: 18,\r\n      maxZoom: 26,\r\n      minZoom: 12,\r\n      zoomDelta: 2,\r\n      layers: [streetsLayer, myLayerGroup] // loads with this layer initially\r\n    });\r\n    // create group of basemap layers\r\n    let baseMaps = {\r\n      Greyscale: greyscaleLayer,\r\n      Streets: streetsLayer,\r\n      Satellite: satLayer\r\n    };\r\n    this.basemaps = baseMaps;\r\n    myMap.streetsLayer = streetsLayer;\r\n    myMap.satLayer = satLayer;\r\n    myMap.greyscaleLayer = greyscaleLayer;\r\n\r\n    // create group of overlay layers\r\n    let overlayMaps = {\r\n      myLayers: myLayerGroup\r\n    };\r\n    this.overlayMap = overlayMaps;\r\n    this.LayersControl = L.control.layers(baseMaps).addTo(map);\r\n    return map;\r\n  }\r\n};\r\n\r\n// the App object holds the GeoJSON layer and manages all it's interactions with the user\r\nexport const App = {\r\n  State: {\r\n    relatedData: {}, // init va3l\r\n\r\n    relDataSyncStatus: {}, // objects holds relatedData sync status flag for each feature, TRUE if synced , False\r\n    surveyed: {}, // true when inspected ie completed , false when not-yet-instected\r\n    completedResetDate: new Date(2018, 9, 1, 0, 0, 0, 0),\r\n    symbology: {\r\n      uncompletedColor: \"red\",\r\n      uncompletedfillColor: \"red\",\r\n      uncompletedLineWeight: 8,\r\n      completedLineWeight: 4,\r\n      uncompletedRadius: 8,\r\n      completedColor: \"grey\",\r\n      completedFillColor: \"grey\",\r\n      completedRadius: 2 // placeholder  - start of year\r\n    },\r\n    visableFeatures: [],\r\n    formFields: {\r\n      condition: {\r\n        null: \"\",\r\n        c1: \"(1 - hazard)\",\r\n        c2: \"2 - (unfit for purpose)\",\r\n        c3: \"3\",\r\n        c4: \"4\",\r\n        c5: \"5\",\r\n        c6: \"6\",\r\n        rm: \"removed / not found\",\r\n        nv: \"not visable\",\r\n        pv: \"partially visable\"\r\n      }\r\n    }\r\n  },\r\n\r\n  populateConditionInputField: () => {\r\n    const conditionSelect = document.getElementById(\"related-data-condition\");\r\n    Object.keys(App.State.formFields.condition).forEach(function(key) {\r\n      const option = document.createElement(\"option\");\r\n      option.value = key;\r\n      option.text = App.State.formFields.condition[key];\r\n      conditionSelect.add(option);\r\n    });\r\n  },\r\n\r\n  updateRelDataSyncMsg: featureID => {\r\n    const relSyncDiv = document.getElementById(\"rel-data-sync-message\");\r\n    if (relSyncDiv == null) return; //exit if element doesn yet exist ie of form is'nt open\r\n    let msg = \"\";\r\n    const s = App.State.relDataSyncStatus[featureID];\r\n    if (s == null) {\r\n      msg = \"no related data\";\r\n    } else if (s == true) {\r\n      msg = \"successful sync\";\r\n    } else if (s == false) {\r\n      msg =\r\n        \"Data not yet synced - please connect to network before closing this App\";\r\n    }\r\n    relSyncDiv.innerHTML = msg;\r\n    relSyncDiv.style = \"color:'CornflowerBlue' \";\r\n  },\r\n\r\n  whenGeoFeatureClicked: function() {\r\n    const fId =\r\n      App.selectedFeature.properties.OBJECTID +\r\n      App.selectedFeature.geometry.type;\r\n\r\n    function renderSideBar() {\r\n      App.sidebar.setContent(\r\n        document.getElementById(\"form-template\").innerHTML\r\n      );\r\n    }\r\n    let p = App.selectedFeature.properties;\r\n    renderSideBar();\r\n    this.generateFormElements(p);\r\n    if (p.photo !== null && p.photo !== undefined) {\r\n      this.getPhoto(p.photo);\r\n    }\r\n    App.updateRelDataSyncMsg(fId);\r\n    App.updateSidebarRelatedFromState(fId);\r\n    App.populateConditionInputField();\r\n    App.sidebar.show();\r\n  },\r\n\r\n  findNearestFeatures: function() {\r\n    if (myMap.state.latestLocation) {\r\n      const nearest = leafletKnn(App.geoLayer).nearest(\r\n        L.latLng(myMap.state.latestLocation),\r\n        1\r\n      ); // example usage for Ham Green\r\n      nearest[0].layer.fire(\"click\");\r\n    } else {\r\n      window.alert(\"Sorry failed - You need to get a GPS location first\");\r\n    }\r\n  },\r\n\r\n  /*\r\n    createFormItem: function(parentTag, el, type, prop, value) {\r\n        const wrapperDiv = createWrapperDiv(parentTag);\r\n        createLabel(wrapperDiv, el, type, prop, value);\r\n        createInputBox(wrapperDiv, el, type, prop, value);\r\n\r\n        function createWrapperDiv() {\r\n            let x = document.createElement(\"div\");\r\n            x.classList.add(\"form-group\");\r\n            parentTag.appendChild(x);\r\n            return x;\r\n        }\r\n\r\n        function createInputBox(parent) {\r\n            let x = document.createElement(el);\r\n            x.setAttribute(\"type\", type);\r\n            x.type = type;\r\n            x.classList.add(\"form-control\");\r\n            x.value = value;\r\n            x.id = String(\"input_\" + prop);\r\n            if (type === \"Checkbox\") {\r\n                console.log(\"checkboxValue: \" + value);\r\n                x.checked = value;\r\n            }\r\n            parent.appendChild(x);\r\n        }\r\n\r\n        function createLabel(parent) {\r\n            let x = document.createElement(\"label\");\r\n            x.innerHTML = prop;\r\n            parent.appendChild(x);\r\n        }\r\n    },\r\n\r\n    */\r\n\r\n  createFormItem: function(parentTag, el, type, prop, value) {\r\n    const wrapperDiv = createWrapperDiv(parentTag);\r\n    createLabel(wrapperDiv, el, type, prop, value);\r\n    //createInputBox(wrapperDiv, el, type, prop, value);\r\n    createValueLabel(wrapperDiv, el, type, prop, value);\r\n    //createRow(wrapperDiv, el, type, prop, value);\r\n\r\n    function createWrapperDiv() {\r\n      let x = document.createElement(\"tr\");\r\n      // x.classList.add(\"\");\r\n      parentTag.appendChild(x);\r\n      return x;\r\n    }\r\n\r\n    function createValueLabel(parent) {\r\n      let x = document.createElement(\"td\");\r\n      //x.classList.add(\"col-sm-9\")\r\n      x.innerHTML = value;\r\n      parent.appendChild(x);\r\n      if (type === \"Checkbox\") {\r\n        x.checked = value;\r\n      }\r\n      parent.appendChild(x);\r\n    }\r\n\r\n    function createLabel(parent) {\r\n      let x = document.createElement(\"td\");\r\n      //x.classList.add(\"col-sm-3\")\r\n      x.innerHTML = prop;\r\n      parent.appendChild(x);\r\n    }\r\n\r\n    function createRow(parent) {\r\n      let x = document.createElement(\"div\");\r\n      x.innerHTML = prop + \" \" + value + \"<br>\";\r\n      parent.appendChild(x);\r\n    }\r\n  },\r\n\r\n  generateFormElements: function(props) {\r\n    const fs = document.getElementById(\"fields-section\");\r\n    fs.innerHTML = null;\r\n    const myFunc = Object.keys(props).forEach(function(key) {\r\n      const propType = typeof props[key];\r\n      if (propType === \"string\" || propType === \"number\") {\r\n        App.createFormItem(fs, \"Input\", \"text\", key, props[key]);\r\n      } else if (propType === \"boolean\") {\r\n        App.createFormItem(fs, \"Input\", \"Checkbox\", key, props[key]);\r\n      } else {\r\n        console.log(\"NOT OK: \" + typeof key);\r\n      }\r\n    });\r\n  },\r\n\r\n  submitForm: function() {\r\n    let p = App.selectedFeature.properties;\r\n    readSidebarFormProperties(p);\r\n    App.selectedLayer.setTooltipContent(p.Asset);\r\n    App.sidebar.hide();\r\n    //this.assignTaskCompletedStyle(this.selectedLayer, p);\r\n    //Map.closePopup();\r\n    this.selectedFeature = null;\r\n    localStorage.setItem(\"geoJSON\", JSON.stringify(this.geoLayer.toGeoJSON()));\r\n\r\n    function readSidebarFormProperties(props) {\r\n      const myFunc = Object.keys(props).forEach(function(key) {\r\n        const propType = typeof props[key];\r\n        const el = document.getElementById(String(\"input_\" + key));\r\n        if (propType === \"string\" || propType === \"number\") {\r\n          props[key] = el.value;\r\n        } else if (propType === \"boolean\") {\r\n          props[key] = el.checked;\r\n        }\r\n      });\r\n    }\r\n\r\n    function saveFeatureToFirebase() {\r\n      // current id - id of 1st element in geo Array - I guess\r\n      if (!window.confirm(\"Save feature to cloud\")) {\r\n        console.log(\"save Cancelled!\");\r\n        return;\r\n      }\r\n      const featureIndex =\r\n        App.selectedLayer._leaflet_id -\r\n        Object.keys(App.geoLayer._layers)[0] -\r\n        1;\r\n      const nodePath = String(\"App/Maps/\" + App.mapHash + \"/Geo/features\");\r\n      const Ob = {};\r\n      const myKey = featureIndex;\r\n      Ob[myKey] = App.selectedFeature;\r\n      fbDatabase\r\n        .ref(nodePath)\r\n        .update(Ob)\r\n        .then(function() {\r\n          console.log(\"saved to firebase!\");\r\n        })\r\n        .catch(function() {\r\n          alert(\"Sorry - you need to be logged in to do this\");\r\n        });\r\n    }\r\n  },\r\n\r\n  assignTaskCompletedStyle: function(layer, featureProperty) {\r\n    const s = myMap.settings.symbology;\r\n    if (featureProperty.taskCompleted == true) {\r\n      layer.setStyle(s.taskCompleteStyle);\r\n    } else {\r\n      if (layer.feature.geometry.type.includes(\"Poly\")) {\r\n        layer.setStyle(s.polyTaskNotCompleteStyle);\r\n      } else if (layer.feature.geometry.type.includes(\"Line\")) {\r\n        layer.setStyle(s.lineTaskNotCompleteStyle);\r\n      } else if (layer.feature.geometry.type.includes(\"Point\")) {\r\n        layer.setStyle(s.pointTaskNotCompleteStyle);\r\n      }\r\n    }\r\n  },\r\n\r\n  resetMap: function() {\r\n    localStorage.removeItem(\"geoJSON\");\r\n    App.geoLayer = {};\r\n  },\r\n  getPhoto: function(photoURL) {\r\n    fetch(photoURL)\r\n      .then(res => res.blob()) // Gets the response and returns it as a blob\r\n      .then(blob => {\r\n        console.log(\"blob!\");\r\n        const objectURL = URL.createObjectURL(blob);\r\n        const myImage = new Image(350);\r\n        myImage.src = objectURL;\r\n        myImage.css = \"width:500px\";\r\n        document.getElementById(\"photo-div\").appendChild(myImage);\r\n      });\r\n  },\r\n  uploadChanges: function() {\r\n    // posts to shared hosting\r\n    const url = App.settings.uploadjsonURL;\r\n    fetch(url, {\r\n      method: \"POST\", // or 'PUT'\r\n      body: \"name=\" + JSON.stringify(this.geoLayer.toGeoJSON()), // data can be `string` or {object}!\r\n      headers: {\r\n        \"Content-type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\r\n      }\r\n    })\r\n      .then(res => {\r\n        console.log(\"json sent ok apparently!\");\r\n      })\r\n      .catch(error => console.error(\"Error:\", error))\r\n      .then(response => console.log(\"Success:\", response));\r\n  },\r\n\r\n  initSettingsControl: () => {\r\n    L.Control.myControl = L.Control.extend({\r\n      onAdd: e => {\r\n        const myControl_div = L.DomUtil.create(\r\n          \"button\",\r\n          \"main-button-control btn btn-lg btn-danger icon-cog\"\r\n        );\r\n        myControl_div.innerHTML = \"\";\r\n        myControl_div.title = \"Settings\";\r\n        myControl_div.onclick = () => {\r\n          App.sidebar.setContent(\r\n            document.getElementById(\"settings-template\").innerHTML\r\n          );\r\n\r\n          User().initLoginForm();\r\n\r\n          /*\r\n                    const savefb = document.getElementById(\r\n                        \"upload-map-to-firebase\"\r\n                    );\r\n                    */\r\n          if (App.geoLayer === undefined || App.geoLayer === null) {\r\n            //savefb.style.display = \"none\";\r\n          } else {\r\n            //savefb.style.display = \"block\";\r\n            App.populateMapMeta();\r\n          }\r\n          document\r\n            .getElementById(\"open-new-project-button\")\r\n            .addEventListener(\"click\", function() {\r\n              loadMyLayer(\"dummy\");\r\n            });\r\n          App.sidebar.show();\r\n        };\r\n        return myControl_div;\r\n      }\r\n    });\r\n    L.control.myControl = opts => {\r\n      return new L.Control.myControl(opts);\r\n    };\r\n    L.control\r\n      .myControl({\r\n        position: \"bottomleft\"\r\n      })\r\n      .addTo(Map);\r\n  },\r\n\r\n  populateMapMeta: function() {\r\n    const container = document.getElementById(\"map-info-section\");\r\n    let content = \"\";\r\n    for (const item in App.mapMeta) {\r\n      if (item !== null && item !== undefined) {\r\n        console.log(\"meta attribute: \" + item);\r\n        content += String(item + \": \" + App.mapMeta[item] + \"<br>\");\r\n      }\r\n    }\r\n    container.innerHTML = content;\r\n  },\r\n\r\n  busyWorkingIndicator: busyWorking => {\r\n    const cogIcon = document.getElementsByClassName(\"icon-cog\")[0];\r\n    if (busyWorking) {\r\n      cogIcon.classList.add(\"icon-cog-spin\");\r\n    } else {\r\n      cogIcon.classList.remove(\"icon-cog-spin\");\r\n    }\r\n  },\r\n\r\n  retrieveMapFromFireBase: function(index) {\r\n    let nodePath = String(\"/App/Maps/\" + index);\r\n    App.sidebar.hide();\r\n    App.busyWorkingIndicator(true);\r\n    fbDatabase\r\n      .ref(nodePath)\r\n      .once(\"value\")\r\n      .then(snapshot => {\r\n        const mapData = snapshot.val();\r\n        App.clearLocalStorageMaps();\r\n        App.setupGeoLayer(index, mapData);\r\n        document.getElementById(\"opennewproject\").style.display = \"none\";\r\n        App.busyWorkingIndicator(false);\r\n      })\r\n      .catch(err => {\r\n        console.log(\"error! cannot get from firebase!\", err);\r\n        App.busyWorkingIndicator(false);\r\n      });\r\n  },\r\n\r\n  saveMapToLocalStorage: (myKey, mapData) => {\r\n    localStorage.setItem(\"mapData.\" + myKey, JSON.stringify(mapData));\r\n  },\r\n\r\n  clearLocalStorageMaps: () => {\r\n    const keys = App.getLocalStorageMapDataKey();\r\n    keys.map(item => {\r\n      localStorage.removeItem(item);\r\n    });\r\n  },\r\n\r\n  clearLocalStorageLatestRelDataBackup: () => {\r\n    localStorage.removeItem(\"latestRelDataBackup\");\r\n  },\r\n\r\n  populateRelated: related => {\r\n    if (related == null || related == undefined) {\r\n      return;\r\n    }\r\n\r\n    const relDataObject = {}; // to be replaced with State etc\r\n    const relDataSyncObject = {}; // just to make sure it's initially empty\r\n    App.State.relDataSyncStatus = {}; // make sure start with empty obj\r\n    App.State.relatedData = {};\r\n    const getLastRelDataItem = RelDataSet => {\r\n      const sortedKeys = Object.keys(RelDataSet).sort();\r\n      const lastDataItem = RelDataSet[sortedKeys[sortedKeys.length - 1]];\r\n      return lastDataItem;\r\n    };\r\n\r\n    App.State.relatedData = Object.keys(related).map((relKey, index) => {\r\n      //attachRelatedToRecord(relKey, index, relDataObject);\r\n      console.log(\"relkey, Index:\", relKey, index);\r\n      const itemOb = {};\r\n      const lastItem = getLastRelDataItem(related[relKey]);\r\n      itemOb[relKey] = lastItem;\r\n      relDataObject[relKey] = lastItem;\r\n      relDataSyncObject[relKey] = true; // ie the feature's rela data is now synced\r\n      return itemOb;\r\n    });\r\n    App.State.relatedData = relDataObject;\r\n    App.State.relDataSyncStatus = relDataSyncObject;\r\n    App.getRelDataFromLocalStorage(App.mapHash);\r\n  },\r\n\r\n  getRelDataFromLocalStorage: mapHash => {\r\n    const regex = \"backup.relatedData.\" + mapHash + \".\";\r\n\r\n    const relDataKeys = Object.keys(localStorage).filter(item =>\r\n      item.match(regex)\r\n    );\r\n    if (relDataKeys.length == 0) return;\r\n    relDataKeys.map(key => {\r\n      const item = JSON.parse(localStorage.getItem(key));\r\n      const itemFeatureKey = key.split(regex)[1]; //  element 1 is str after split point\r\n      const relDataFeaturePath =\r\n        \"App/Maps/\" + mapHash + \"/Related/\" + itemFeatureKey;\r\n      const localStorageTime = new Date(item.timestamp);\r\n      const stateTime = new Date(\r\n        App.State.relatedData[itemFeatureKey].timestamp\r\n      );\r\n      console.log(localStorageTime.getTime(), stateTime.getTime());\r\n      if (localStorageTime.getTime() > stateTime.getTime()) {\r\n        console.log(\r\n          \"New item to upload! : \",\r\n          itemFeatureKey,\r\n          item.timestamp,\r\n          \"State Timestamp:\",\r\n          App.State.relatedData[itemFeatureKey].timestamp\r\n        );\r\n        App.updateFeatureRelatedState(itemFeatureKey, item);\r\n        App.State.relDataSyncStatus[key] = false; // while item is sucessfully pushed to db\r\n        RelatedData.pushRelatedDataRecord(\r\n          relDataFeaturePath,\r\n          itemFeatureKey,\r\n          item\r\n        );\r\n        // Trigger push of item (does this update sync status and message automatically ? )\r\n      }\r\n    });\r\n  },\r\n\r\n  updateFeatureRelatedState: (featureKey, relatedData) => {\r\n    // update a single feature's RelatedRecord State\r\n    App.State.relatedData[featureKey] = relatedData;\r\n    //App.setCompleted(featureKey, true)\r\n  },\r\n\r\n  setCompletedStyle: (\r\n    featureOb,\r\n    layerOb,\r\n    objectID,\r\n    ObjectType,\r\n    isCompleted\r\n  ) => {\r\n    console.log(featureOb, objectID, ObjectType, isCompleted);\r\n    const featureKey = objectID + ObjectType; // strings\r\n\r\n    if (App.State.relatedData[featureKey] !== undefined) {\r\n      var relDataDate = new Date(\r\n        Date.parse(App.State.relatedData[featureKey].timestamp)\r\n      );\r\n      console.log(\"relDataDate: \", relDataDate);\r\n      const refDate = App.State.completedResetDate.getTime();\r\n      var relDate = relDataDate.getTime();\r\n      console.log(\"related for \" + featureKey + \"exists!\");\r\n      if (relDataDate > App.State.completedResetDate) {\r\n        layerOb.setStyle({\r\n          color: App.State.symbology.completedColor, // why not working??\r\n          fillColor: App.State.symbology.completedFillColor,\r\n          weight: App.State.symbology.completedLineWeight,\r\n          radius: 1\r\n          //radius: App.State.symbology.completedRadius\r\n        });\r\n        // if (ObjectType == 'Point'){layerOb.setStyle({radius: App.State.symbology.completedRadius})}\r\n      }\r\n    }\r\n  },\r\n\r\n  updateSidebarRelatedFromState: featureKey => {\r\n    // update a feature's RelatedRecord State\r\n    const reldiv = document.getElementById(\"latest-related\");\r\n    reldiv.innerHTML = \"\";\r\n    const relSet = App.State.relatedData[featureKey];\r\n    if (relSet) {\r\n      Object.keys(relSet).map(key => {\r\n        reldiv.innerHTML += key + \": \" + relSet[key] + \"<br>\";\r\n      });\r\n    } else reldiv.innerHTML = \"\";\r\n  },\r\n\r\n  /*\r\n    appendRelatedDataToFeatureState(featureSet, related) {\r\n        if (related === null || related === undefined) {\r\n            return featureSet; // return straight back as is\r\n        }\r\n        const getLastRelDataItem = RelDataSet => {\r\n            const sortedKeys = Object.keys(RelDataSet).sort();\r\n            const lastDataItem = RelDataSet[sortedKeys[sortedKeys.length - 1]];\r\n            return lastDataItem;\r\n        };\r\n\r\n        const attachRelatedToRecord = (relKey, index, relDataOb) => {\r\n            // creates an ob with set of keys with related properties as their values\r\n            relDataOb[relKey] = getLastRelDataItem(related[relKey]);\r\n        };\r\n        const relDataObject = {};\r\n        Object.keys(related).map((relKey, index) => {\r\n            attachRelatedToRecord(relKey, index, relDataObject);\r\n        });\r\n\r\n        const assignPropsToFeature = (feature, featureIndex, relDataObject) => {\r\n            const ObId = String(\r\n                feature.properties.OBJECTID + feature.geometry.type\r\n            );\r\n            Object.assign(\r\n                featureSet[featureIndex].properties,\r\n                relDataObject[ObId]\r\n            ); // asign related Props to feature\r\n        };\r\n        const updatedFeatureSet = featureSet.map((feature, index) => {\r\n            assignPropsToFeature(feature, index, relDataObject);\r\n        });\r\n        const featureState = this.state.geoJson; // get a ref to state\r\n        //featureState.features = featureSet;\r\n        //this.setState(featureState);\r\n    },\r\n    */\r\n\r\n  setupGeoLayer: (key, mapData) => {\r\n    App.mapMeta = mapData.meta;\r\n    App.mapHash = key;\r\n    myMap.myLayerGroup.clearLayers(App.geoLayer);\r\n    const featureLabelField = mapData.Meta\r\n      ? mapData.Meta.LabelProperty\r\n      : \"Asset\";\r\n    App.populateRelated(mapData.Related); // need to catch when no related available\r\n    App.geoLayer = L.geoJson(mapData.Geo, {\r\n      onEachFeature: (feature, layer) => {\r\n        let featureLabel = feature.properties[featureLabelField];\r\n        //App.assignTaskCompletedStyle(layer, feature.properties);\r\n        App.setCompletedStyle(\r\n          feature,\r\n          layer,\r\n          feature.properties[\"OBJECTID\"],\r\n          feature.geometry.type,\r\n          true\r\n        );\r\n        //if (feature.geometry.type==\"Polygon\"){console.log(\"sent to back!\"); layer.bringToBack()}\r\n        //console.log(\"feature type:\", feature.geometry.type)\r\n\r\n        layer.bindPopup(\r\n          '<div class=\"btn btn-primary large icon-pencil\" onClick=\"App.whenGeoFeatureClicked();\">' +\r\n            \"<br>\" +\r\n            featureLabel +\r\n            \" \" +\r\n            \"</div\"\r\n        );\r\n        //layer.bindTooltip (\"hello!\")\r\n        //layer.bindPopup (featureLabel)\r\n        layer.on(\"click\", e => {\r\n          // restore previouslly selected colours\r\n          //console.log(\"layer:\", layer, \"selectedLayer: \", App.selectedLayer, \"same:\", (layer !== App.selectedLayer))\r\n          if (App.selectedLayer !== layer) {\r\n            console.log(\"selected Layer NOT same as Layer\");\r\n            if (App.selectedLayer) {\r\n              App.unsetSelectedStyle();\r\n            }\r\n            App.State.symbology.beforeSelectedColor = layer.options.color;\r\n            App.State.symbology.beforeSelectedFillColor =\r\n              layer.options.fillColor;\r\n            App.State.symbology.beforeSelectedLineWeight = layer.options.weight;\r\n\r\n            // now reset the style of the old layer\r\n          } else {\r\n            console.log(\"selected Layer IS same as Layer\");\r\n          }\r\n\r\n          App.selectedFeature = feature; // expose selected feature and layer\r\n          App.selectedLayer = layer;\r\n          App.selectedLayer.setStyle({\r\n            color: \"blue\",\r\n            fillColor: \"blue\",\r\n            weight: 2\r\n          });\r\n\r\n          // App.whenGeoFeatureClicked();\r\n          //let myButton = L.DomUtil.create('button');\r\n          //myButton.innerHTML = \"Hello\"\r\n          //this.bindPopup = myButton\r\n        });\r\n        /*\r\n                try {\r\n                    layer.bindTooltip(featureLabel, {\r\n                        className: \"tool-tip-class\",\r\n                        permanent: false,\r\n                        interactive: true\r\n                    }).openTooltip();\r\n                } catch (err) {\r\n                    console.log(\"failed to find prop\", err);\r\n                }\r\n                */\r\n      },\r\n      style: feature => {\r\n        return {\r\n          fillOpacity: 0.4,\r\n          color: App.State.symbology.uncompletedColor,\r\n          fillColor: App.State.symbology.uncompletedFillColor,\r\n          weight: App.State.symbology.uncompletedLineWeight\r\n          //fillColor: App.State.symbology.uncompletedRadius,\r\n        };\r\n      },\r\n      pointToLayer: (feature, latlng) => {\r\n        return L.circleMarker(latlng, {\r\n          radius: App.State.symbology.uncompletedRadius,\r\n          stroke: true,\r\n          weight: 3,\r\n          opacity: 1,\r\n          fillOpacity: 1\r\n        });\r\n      },\r\n      interactive: true\r\n    });\r\n    myMap.myLayerGroup.addLayer(App.geoLayer);\r\n    Map.fitBounds(App.geoLayer.getBounds());\r\n    App.movePolygonsToBack();\r\n    App.saveMapToLocalStorage(key, mapData);\r\n  },\r\n\r\n  unsetSelectedStyle: () => {\r\n    console.log(\"unselected\", App.selectedLayer);\r\n    App.selectedLayer.setStyle({\r\n      //color: App.State.symbology.beforeSelectedColor,\r\n      color: App.State.symbology.beforeSelectedColor,\r\n      fillColor: App.State.symbology.beforeSelectedFillColor,\r\n      weight: App.State.symbology.beforeSelectedLineWeight\r\n      //fillColor: App.State.symbology.beforeSelectedFillColor\r\n    });\r\n  },\r\n\r\n  movePolygonsToBack() {\r\n    //move polygons to back\r\n    App.geoLayer.eachLayer(layer => {\r\n      if (layer.feature.geometry.type == \"Polygon\") {\r\n        layer.bringToBack();\r\n      }\r\n    });\r\n  },\r\n\r\n  getLocalStorageMapDataKey: () => {\r\n    // return keys that start with maoData\r\n    return Object.keys(localStorage).filter(item => {\r\n      return new RegExp(\"^mapData.*\").test(item);\r\n    });\r\n  },\r\n\r\n  loadMapDataFromLocalStorage: () => {\r\n    // attempt to retrieve map from local\r\n    const storageKey = App.getLocalStorageMapDataKey();\r\n    if (storageKey.length == 0) {\r\n      return;\r\n    }\r\n    const mapData = JSON.parse(localStorage.getItem(storageKey));\r\n    const mapKey = storageKey[0].split(\"mapData.\")[1];\r\n    App.setupGeoLayer(mapKey, mapData);\r\n  },\r\n\r\n  featureLabels: () => {\r\n    const bounds = Map.getBounds();\r\n    if (App.State.visableFeatures !== null) {\r\n      App.State.visableFeatures.map(layer => {\r\n        layer.unbindTooltip();\r\n      });\r\n      App.State.visableFeatures = [];\r\n    }\r\n    if (Map.getZoom() < 20) {\r\n      return;\r\n    }\r\n    const redrawToolTips = () => {\r\n      App.geoLayer.eachLayer(function(layer) {\r\n        //console.log (layer)\r\n        //layer.unbindTooltip()\r\n        let relID = \"\";\r\n        let hasRelData;\r\n        try {\r\n          relID =\r\n            layer.feature.properties.OBJECTID + layer.feature.geometry.type;\r\n          hasRelData = App.State.relatedData[relID];\r\n          //console.log (hasRelData)\r\n        } catch (err) {\r\n          relID = undefined;\r\n          hasRelData = false;\r\n          //console.log(\"undefined!\", )\r\n        }\r\n        //console.log(hasRelData)\r\n\r\n        if (layer.getLatLng && !hasRelData) {\r\n          //console.log (\"latlng:\",layer.getLatlng)\r\n          if (bounds.contains(layer.getLatLng())) {\r\n            //console.log(layer)\r\n            App.State.visableFeatures.push(layer);\r\n          }\r\n        } else if (layer.getBounds && !hasRelData) {\r\n          if (\r\n            bounds.intersects(layer.getBounds()) ||\r\n            bounds.contains(layer.getBounds())\r\n          ) {\r\n            //console.log(layer)\r\n            App.State.visableFeatures.push(layer);\r\n          }\r\n        }\r\n      });\r\n    };\r\n    redrawToolTips();\r\n    // console.log(\"new bounds\", bounds)\r\n    App.State.visableFeatures.map(layer => {\r\n      layer.bindTooltip(layer.feature.properties.Asset, {\r\n        permanent: true,\r\n        interactive: true\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nwindow.App = App;\r\n\r\nconst RelatedData = {\r\n  saveRelDataRecordToLocalStorage: (mapHash, featureKey, relatedData) => {\r\n    localStorage.setItem(\r\n      \"backup.relatedData.\" + mapHash + \".\" + featureKey,\r\n      JSON.stringify(relatedData)\r\n    );\r\n  },\r\n\r\n  pushRelatedDataRecord: (relDataPath, featureKey, relatedRecord) => {\r\n    fbDatabase\r\n      .ref(relDataPath) // meed to move this constant into App.State\r\n      .push(relatedRecord)\r\n      .then(snap => {\r\n        // if successfully synced\r\n\r\n        const f_id = snap.parent.key; // fudege to retrieve feature key\r\n        App.State.relDataSyncStatus[f_id] = true;\r\n        App.updateRelDataSyncMsg(f_id);\r\n        console.log(\"Pushed new Related Record :\", f_id);\r\n        // Remove record from local storage\r\n        const localStorageKey =\r\n          \"backup.relatedData.\" + App.mapHash + \".\" + featureKey;\r\n        localStorage.removeItem(localStorageKey);\r\n      })\r\n      .catch(error => {\r\n        console.log(\"My Error: \" + error.message);\r\n        alert(\"Sorry - something went wrong - have you logged in etc?\");\r\n      });\r\n  },\r\n\r\n  submit: () => {\r\n    // calculate key from OBJECTID + geometrytype\r\n    RelatedData.featureKey = String(\r\n      App.selectedFeature.properties.OBJECTID +\r\n        App.selectedFeature.geometry.type\r\n    );\r\n\r\n    App.selectedFeature.geometry.type + \"/\";\r\n    console.log(\"key: \" + RelatedData.featureKey);\r\n    RelatedData.nodePath = String(\r\n      \"App/Maps/\" + App.mapHash + \"/Related/\" + RelatedData.featureKey + \"/\"\r\n    );\r\n    console.log(\"nodePath: \" + RelatedData.nodePath);\r\n    const relatedRecord = {};\r\n    relatedRecord.timestamp = Date();\r\n    relatedRecord.user = firebase.auth().currentUser.displayName;\r\n    relatedRecord.condition = document.getElementById(\r\n      \"related-data-condition\"\r\n    ).value;\r\n    if (document.getElementById(\"related-data-comments\").value) {\r\n      relatedRecord.comments = document.getElementById(\r\n        \"related-data-comments\"\r\n      ).value;\r\n    }\r\n    if (document.getElementById(\"related-data-photo\").value) {\r\n      relatedRecord.photo = document.getElementById(\"related-data-photo\").value;\r\n    }\r\n    const key = RelatedData.featureKey;\r\n    App.State.relDataSyncStatus[key] = false; // while push promise is unresolved\r\n    App.updateRelDataSyncMsg(key);\r\n    App.updateFeatureRelatedState(key, relatedRecord);\r\n\r\n    App.updateSidebarRelatedFromState(key);\r\n    //RelatedData.backupUpRelStateToLocalStorage()\r\n    RelatedData.saveRelDataRecordToLocalStorage(\r\n      App.mapHash,\r\n      key,\r\n      relatedRecord\r\n    );\r\n    // RelatedData.backupUpRelStateToLocalStorage();\r\n    RelatedData.pushRelatedDataRecord(RelatedData.nodePath, key, relatedRecord);\r\n    document.getElementById(\"related-data-info\").innerHTML = \"Submitted!\";\r\n    App.State.symbology.beforeSelectedColor =\r\n      App.State.symbology.completedColor;\r\n    App.State.symbology.beforeSelectedFillColor =\r\n      App.State.symbology.completedFillColor;\r\n  },\r\n\r\n  backupUpRelStateToLocalStorage: () => {\r\n    localStorage.setItem(\r\n      \"latestRelDataBackup\",\r\n      JSON.stringify(App.State.relatedData)\r\n    );\r\n  },\r\n\r\n  restoreRelStateFromLocalStorage: () => {\r\n    if (localStorage.getItem(\"latestRelDataBackup\") !== null) {\r\n      App.State.relatedData = JSON.parse(\r\n        localStorage.getItem(\"latestRelDataBackup\")\r\n      );\r\n    } else {\r\n      App.State.relatedData = {};\r\n    }\r\n  },\r\n\r\n  addPhoto: function() {\r\n    const el = document.getElementById(\"photo-capture\");\r\n    console.log(el.files[0].name);\r\n    document.getElementById(\"related-data-photo\").value = el.files[0].name;\r\n  }\r\n};\r\n\r\nwindow.RelatedData = RelatedData;\r\n\r\nfunction uploadMapToFirebase() {\r\n  // grab the blobal Mapindex, then send gson layer up to node\r\n  //const nodePath = String(\"'/App/Maps/\" + myMap.settings.mapIndex)\r\n  const nodePath = String(\"App/Maps/\" + App.mapHash + \"/Geo\");\r\n\r\n  fbDatabase\r\n    .ref(nodePath)\r\n    .set(App.geoLayer.toGeoJSON())\r\n    .catch(function(error) {\r\n      alert(\"Sorry you need to be logged in to do this\");\r\n    });\r\n}\r\n\r\nwindow.User = User;\r\n\r\nfunction loadMyLayer(layerName) {\r\n  // just for testing\r\n\r\n  document.getElementById(\"open-new-project-button\").style.display = \"none\";\r\n  //loadFromPresetButtons(layerName);\r\n  // console.log(\"LoadmyLayer!\")\r\n  loadProject();\r\n\r\n  function loadProject() {\r\n    /*\r\n        const mapIndexList = getLocalStorageMapIndexList()\r\n        if (mapIndexList) {\r\n            displayMapIndeces(mapIndexList)\r\n        } else {\r\n            console.log(\"local mapIndex list not found so try from Firebase\")\r\n            retriveMapIndexFromFirebase()\r\n        }\r\n        */\r\n\r\n    retriveMapIndexFromFirebase();\r\n\r\n    //const el = document.getElementById(\"opennewproject\");\r\n    // el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n    // displayMapIndeces(myMapIndeces);\r\n\r\n    /*\r\n        function getLocalStorageMapIndexList() {\r\n            const mapIndexList = JSON.parse(localStorage.getItem('mapIndexList'))\r\n            return mapIndexList\r\n        }\r\n\r\n        function setLocalStorageMapIndexList(mapIndexList) {\r\n            localStorage.setItem(\r\n                'mapIndexList', JSON.stringify(mapIndexList)\r\n            )\r\n        };\r\n\r\n         */\r\n    /*\r\n\r\n        function retriveMapIndexFromFirebase() {\r\n            fbDatabase\r\n                .ref(\"/App/Mapindex\")\r\n                .once(\"value\")\r\n                .then(snapshot => {\r\n                    document.getElementById(\"message-area\").innerHTML = null;\r\n                    console.log(\"fetched ok: \");\r\n                    //const el = document.getElementById(\"opennewproject\");\r\n                    //el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n                    // setLocalStorageMapIndexList(snapshot)\r\n                    displayMapIndeces(snapshot);\r\n                })\r\n                .catch(error => {\r\n                    console.log(\"My Error: \" + error.message);\r\n                    document.getElementById(\"message-area\").innerHTML =\r\n                        \"Sorry - \" + error.message;\r\n                });\r\n        };\r\n\r\n        */\r\n\r\n    function retriveMapIndexFromFirebase() {\r\n      document.getElementById(\"message-area\").innerHTML =\r\n        \"<p>waiting for network connection ...</p>\";\r\n      fbDatabase\r\n        .ref(\"/App/Mapindex\")\r\n        .once(\"value\")\r\n        .then(function(snapshot) {\r\n          document.getElementById(\"message-area\").innerHTML = null;\r\n          console.log(\"map index fetched ok: \");\r\n          const el = document.getElementById(\"opennewproject\");\r\n          el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n          displayMapIndeces(snapshot.val());\r\n        })\r\n        .catch(error => {\r\n          console.log(\"My Error: \" + error.message);\r\n          document.getElementById(\"message-area\").innerHTML =\r\n            \"Sorry - \" + error.message;\r\n        });\r\n    }\r\n\r\n    function displayMapIndeces(mapIndexList) {\r\n      //const el = document.getElementById(\"opennewproject\");\r\n      //el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n\r\n      const el = document.getElementById(\"opennewproject\");\r\n      el.insertAdjacentHTML(\"afterBegin\", \"Open project\");\r\n      // Object.values(snapshot.val()).map(item => {\r\n      Object.values(mapIndexList).map(item => {\r\n        const btn = document.createElement(\"button\");\r\n        console.log(item.description);\r\n        btn.setAttribute(\"value\", item.mapID);\r\n        btn.setAttribute(\"title\", item.description);\r\n        btn.className = \"btn btn-primary open-project-button\";\r\n        const id = item.mapID;\r\n        btn.addEventListener(\"click\", function(e) {\r\n          App.retrieveMapFromFireBase(e.target.value);\r\n          myMap.settings.mapIndex = e.target.value; // store map Index\r\n        });\r\n        btn.innerHTML = item.name;\r\n        maplist.appendChild(btn);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction initLogoWatermark() {\r\n  L.Control.watermark = L.Control.extend({\r\n    onAdd: e => {\r\n      const watermark = L.DomUtil.create(\"IMG\", \"watermark\");\r\n      watermark.src = \"ORCL-logo-cropped.png\";\r\n      watermark.style.opacity = 0.3;\r\n      return watermark;\r\n    }\r\n  });\r\n  L.control.watermark = opts => {\r\n    return new L.Control.watermark(opts);\r\n  };\r\n  L.control.watermark({ position: \"bottomright\" }).addTo(Map);\r\n}\r\n\r\n/*\r\nfunction initDebugControl() {\r\n    let debugControl_div;\r\n    Map.on(\"locationfound\", onLocationFound);\r\n    Map.on(\"locationerror\", onLocationError);\r\n\r\n    function onLocationFound(e) {\r\n        debugToMap(\"type: \" + e.type + \", accuracy: \" + e.accuracy + \"<br>\");\r\n        console.log(\"location success\");\r\n        console.log(\"location found: \", e);\r\n    }\r\n\r\n    function onLocationError() {\r\n        debugToMap(\"location failed\");\r\n    }\r\n\r\n    function debugToMap(message) {\r\n        let d = new Date();\r\n        debugControl_div.innerHTML +=\r\n            d.getMinutes() + \":\" + d.getSeconds() + \" \" + message + \"<br>\";\r\n    }\r\n\r\n    L.Control.debugControl = L.Control.extend({\r\n        onAdd: e => {\r\n            debugControl_div = L.DomUtil.create(\"div\");\r\n            debugControl_div.onclick = function() {\r\n                console.log(\"debug control clicked!\");\r\n            };\r\n\r\n            debugControl_div.style = \"background-color:white; max-width:50vw\";\r\n            return debugControl_div;\r\n        }\r\n    });\r\n    L.control.debugControl = opts => {\r\n        return new L.Control.debugControl(opts);\r\n    };\r\n    L.control\r\n        .debugControl({\r\n            position: \"bottomleft\"\r\n        })\r\n        .addTo(Map);\r\n}\r\n\r\n*/\r\n\r\n// --------------------------------- Offline Basemap Caching ------\r\nconst setupOfflineBaseLayerControls = () => {\r\n  const myBaseLayerControls = [\r\n    {\r\n      object: myMap.streetsLayer,\r\n      label: \"Streets\",\r\n      class: \"streets-offline-control\"\r\n    },\r\n    {\r\n      object: myMap.greyscaleLayer,\r\n      label: \"Greyscale\",\r\n      class: \"greyscale-offline-control\"\r\n    },\r\n    {\r\n      object: myMap.satLayer,\r\n      label: \"Satellite\",\r\n      class: \"satellite-offline-control\"\r\n    }\r\n  ];\r\n  return myBaseLayerControls.map(layer => {\r\n    return L.control.offline(layer.object, tilesDb, {\r\n      saveButtonHtml: `<i id=\"${layer.object}\" title=\"Save ${\r\n        layer.label\r\n      } layer to use offline\" class=\"${layer.class} layer icon-download\">${\r\n        layer.label\r\n      } </i>`,\r\n      removeButtonHtml: '<i class=\"icon-trash \" aria-hidden=\"true\">Delete</i>',\r\n      confirmSavingCallback: function(nTilesToSave, continueSaveTiles) {\r\n        if (window.confirm(\"Save \" + nTilesToSave + \" background tiles?\")) {\r\n          continueSaveTiles();\r\n        }\r\n      },\r\n      confirmRemovalCallback: function(continueRemoveTiles) {\r\n        if (window.confirm(\"Delete All offline tiles?\")) {\r\n          continueRemoveTiles();\r\n        }\r\n      },\r\n      minZoom: 14,\r\n      maxZoom: 18,\r\n      position: \"topright\"\r\n    });\r\n  });\r\n};\r\n\r\nL.Control.OfflineBaselayersControl = L.Control.extend({\r\n  onAdd: function(map) {\r\n    const OfflineBaselayersControl_div = L.DomUtil.create(\r\n      \"button\",\r\n      \"btn btn-sm icon-download btn-info\"\r\n    );\r\n    OfflineBaselayersControl_div.innerHTML = \"Offline <br>Baselayers\";\r\n    OfflineBaselayersControl_div.title =\r\n      \"Save Background layers (tiles) for Offline use\";\r\n    OfflineBaselayersControl_div.onclick = () => {\r\n      const offlineLayerCtrls = document.querySelectorAll(\r\n        \".leaflet-control-offline\"\r\n      );\r\n      if (offlineLayerCtrls[0].style.display == \"none\") {\r\n        offlineLayerCtrls.forEach(el => (el.style.display = \"block\"));\r\n      } else {\r\n        offlineLayerCtrls.forEach(el => (el.style.display = \"none\"));\r\n      }\r\n    };\r\n    return OfflineBaselayersControl_div;\r\n  },\r\n\r\n  onRemove: function(map) {\r\n    // Nothing to do here\r\n  }\r\n});\r\nL.control.OfflineBaselayersControl = opts => {\r\n  return new L.Control.OfflineBaselayersControl(opts);\r\n};\r\n\r\n// ------------------------------------------------------------------\r\n\r\n// firebase\r\nconst fireBaseconfig = {\r\n  apiKey: \"AIzaSyB977vJdWTGA-JJ03xotQkeu8X4_Ds_BLQ\",\r\n  authDomain: \"fir-realtime-db-24299.firebaseapp.com\",\r\n  databaseURL: \"https://fir-realtime-db-24299.firebaseio.com\",\r\n  projectId: \"fir-realtime-db-24299\",\r\n  storageBucket: \"fir-realtime-db-24299.appspot.com\",\r\n  messagingSenderId: \"546067641349\"\r\n};\r\n\r\nvar Map = {};\r\nvar fbDatabase = {};\r\nvar offlineLayerControls = {};\r\nconst initApp = () => {\r\n  //djsModmyFunc.hello();\r\n  App.State.relatedData = {};\r\n  App.State.visableFeatures = [];\r\n  App.State.symbology.beforeSelectedColor = {};\r\n  App.State.symbology.beforeSelectedFillColor = {};\r\n  firebase.initializeApp(fireBaseconfig);\r\n  fbDatabase = firebase.database();\r\n\r\n  // --------------------------------------- Main ---------------------\r\n\r\n  Map = myMap.setupBaseLayer();\r\n  // initDebugControl()\r\n  initLogoWatermark();\r\n  L.control.scale({ position: \"bottomleft\" }).addTo(Map);\r\n  App.initSettingsControl();\r\n  setupSideBar();\r\n  initLocationControl();\r\n  Map.doubleClickZoom.disable();\r\n  L.control.OfflineBaselayersControl({ position: \"topright\" }).addTo(Map);\r\n  offlineLayerControls = setupOfflineBaseLayerControls();\r\n  offlineLayerControls.map(layer => {\r\n    layer.addTo(Map);\r\n  });\r\n  document.querySelectorAll(\".leaflet-control-offline\").forEach(el => {\r\n    el.style.display = \"none\";\r\n  });\r\n  //RelatedData.restoreRelStateFromLocalStorage()\r\n  App.loadMapDataFromLocalStorage();\r\n  window.alert(\"ORCL WebApp version 0.9.05\");\r\n\r\n  // ----- offline service worker -----------\r\n  if (\"serviceWorker\" in navigator) {\r\n    window.addEventListener(\"load\", () => {\r\n      navigator.serviceWorker\r\n        .register(\"sw.js\")\r\n        .then(registration => {\r\n          //  for dev\r\n          console.log(\"SW registered: \", registration);\r\n        })\r\n        .catch(registrationError => {\r\n          console.log(\"SW registration failed: \", registrationError);\r\n        });\r\n    });\r\n  }\r\n};\r\n\r\ninitApp();\r\n\r\n//  ------------------------  leaflet controls -------------\r\n\r\n// ------sidebar controll plugin\r\nfunction setupSideBar() {\r\n  App.sidebar = window.L.control.sidebar(\"sidebar\", {\r\n    position: \"left\",\r\n    closeButton: \"true\",\r\n    autoPan: false\r\n  });\r\n\r\n  Map.addControl(App.sidebar);\r\n}\r\n\r\n// -------------------- GPS location plugin\r\nfunction initLocationControl() {\r\n  App.lc = L.control\r\n    .locate({\r\n      position: \"topright\",\r\n      keepCurrentZoomLevel: true,\r\n      strings: {\r\n        title: \"My location (will use GPS if available)\"\r\n      },\r\n      cacheLocation: false,\r\n      locateOptions: {\r\n        enableHighAccuracy: true,\r\n        timeout: 10000,\r\n        maximumAge: 3000\r\n\r\n        //watch: true\r\n      },\r\n      icon: \"icon-direction\"\r\n    })\r\n    .addTo(Map);\r\n}\r\n\r\nMap.on(\"locationfound\", updateLatestLocation);\r\n//Map.on(\"viewreset\", () => console.log(\"VIEW RESET\"));\r\n\r\nMap.on(\"click\", e => {\r\n  console.log(\"map clicked!!\");\r\n  /*\r\n    App.selectedLayer.setStyle({\r\n        //color: App.State.symbology.beforeSelectedColor,\r\n        //color: 'red',\r\n        //fillColor: App.State.symbology.beforeSelectedFillColor\r\n        //fillColor: 'red'\r\n    })\r\n    */\r\n  App.unsetSelectedStyle();\r\n  App.selectedLayer = null;\r\n  App.selectedFeature = null;\r\n});\r\n\r\nMap.on(\"moveend\", function() {\r\n  console.log(\"moveend!\");\r\n  //App.featureLabels()\r\n});\r\n\r\nMap.on(\"movestart\", function() {\r\n  console.log(\"movestart!\");\r\n  //App.featureLabels()\r\n});\r\n\r\nMap.on(\"viewreset\", function() {\r\n  console.log(\"viewreset\");\r\n});\r\n\r\nMap.on(\"zoomstart\", function() {\r\n  console.log(\"zoomstart!\");\r\n});\r\n\r\nMap.on(\"viewprereset\", function() {\r\n  console.log(\"viewPREreset!\");\r\n});\r\n\r\nMap.on(\"zoomend\", function() {\r\n  console.log(\"zoomend!\");\r\n  /*\r\n    if (Map.getZoom <21){\r\n        if (App.State.visableFeatures !== null){\r\n            App.State.visableFeatures.map (layer =>{\r\n                layer.unbindTooltip ()\r\n            })\r\n        }\r\n    }\r\n    App.featureLabels()\r\n*/\r\n});\r\n\r\nfunction updateLatestLocation(e) {\r\n  //console.log(\"locates location:\", e)\r\n\r\n  myMap.state.latestLocation = e.latlng;\r\n}\r\n\r\n/*\r\nMap.on(\"popupclose\", function(e) {\r\n    App.sidebar.hide();\r\n    App.selectedFeature = null;\r\n    console.log(\"popupClosed!\")\r\n});\r\n*/\r\n","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\leaflet\\\\dist\\\\leaflet-src.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\leaflet-knn\\\\index.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\firebase\\\\dist\\\\index.cjs.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\leaflet-offline\\\\src\\\\leaflet-offline.js\");","module.exports = require(\"..\\\\..\\\\..\\\\node_modules\\\\localforage\\\\dist\\\\localforage.js\");"],"sourceRoot":""}